var __extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},NumJS;!function(t){function e(e,a){return void 0===a&&(a=t.DEFAULT_TYPE_INSTANCE),new a(e)}function a(t,e){for(var a=0,i=t.length;a<i;++a)t[a]=e;return t}function i(t){for(var e=1,a=0,i=t.length;a<i;++a)e*=t[a];return e}function o(t){for(var e=0,a=0,i=t.length;a<i;++a)e+=t[a];return e}function n(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]+=e[a];return t}throw new TypeError("Bad input shapes "+t.length+" "+e.length)}function r(t,e){for(var a=0,i=t.length;a<i;++a)t[a]+=e;return t}function s(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]-=e[a];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)}function p(t,e){for(var a=0,i=t.length;a<i;++a)t[a]-=e;return t}function l(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]*=e[a];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)}function u(t,e){for(var a=0,i=t.length;a<i;++a)t[a]*=e;return t}function d(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]/=e[a];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)}function h(t,e){for(var a=0,i=t.length;a<i;++a)t[a]/=e;return t}function m(t,e,a){if(t.length===e.length){for(var i=0,o=t.length;i<o;++i)t[i]+=a*e[i];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)}t.DEFAULT_TYPE_INSTANCE=Float32Array,t.zeros=e,t.fill=a,t.prod=i,t.sum=o,t.add=n,t.addConst=r,t.sub=s,t.subConst=p,t.mul=l,t.mulByConst=u,t.div=d,t.divByConst=h,t.addScaled=m}(NumJS||(NumJS={}));var NumJS;!function(t){function e(t){for(var e=Number.NEGATIVE_INFINITY,a=0,i=t.length;a<i;++a)t[a]>e&&(e=t[a]);return e}function a(t){for(var e=Number.NEGATIVE_INFINITY,a=0,i=0,o=t.length;i<o;++i)t[i]>e&&(e=t[i],a=i);return a}function i(t,e){return e=e||3,t.slice(0).sort(function(t,e){return e-t}).slice(0,e)}function o(t,e){e=e||3;for(var a=t.length,i=new Uint32Array(a),o=0;o<a;++o)i[o]=o;return i.sort(function(e,a){return t[a]-t[e]}).slice(0,e)}function n(t){if(0===t.length)return{};for(var e=t[0],a=t[0],i=0,o=0,n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n],i=n),t[n]<a&&(a=t[n],o=n);return{maxi:i,maxv:e,mini:o,minv:a,dv:e-a}}t.max=e,t.argmax=a,t.maxn=i,t.argmaxn=o,t.maxmin=n}(NumJS||(NumJS={}));var NumJS;!function(t){function e(){if(r)return r=!1,s;var t=2*Math.random()-1,a=2*Math.random()-1,i=t*t+a*a;if(0==i||i>1)return e();var o=Math.sqrt(-2*Math.log(i)/i);return s=a*o,r=!0,t*o}function a(t,e){return Math.random()*(e-t)+t}function i(t,e){return Math.floor(Math.random()*(e-t)+t)}function o(t,a){return t+e()*a}function n(t){for(var e,a=t,i=0,o=[],n=0;n<t;++n)o[n]=n;for(;a--;)i=Math.floor(Math.random()*(a+1)),e=o[a],o[a]=o[i],o[i]=e;return o}var r=!1,s=0;t.gaussRandom=e,t.randf=a,t.randi=i,t.randn=o,t.randperm=n}(NumJS||(NumJS={}));var NumJS;!function(t){function e(t,e,a){return Math.max(Math.min(t,a),e)}function a(t,e){return(t%e+e)%e}function i(t){var e=Math.exp(2*t);return(e-1)/(e+1)}t.clip=e,t.mod=a,t.tanh=i}(NumJS||(NumJS={}));var Net;!function(t){var e=NumJS,a=function(){function t(t,a,i,o){this.sx=t,this.sy=a,this.depth=i;var n=this.sx*this.sy*this.depth;if(this.w=e.zeros(n),void 0===o)for(var r=Math.sqrt(1/n),s=0;s<n;++s)this.w[s]=e.randn(0,r);else 0!==o&&e.fill(this.w,o)}return t.fromArray=function(e){var a=new t(1,1,e.length,0);return a.w.set(e),a},t.prototype.clone=function(){var e=new t(this.sx,this.sy,this.depth,0);return e.w.set(this.w),e},t.prototype.cloneAndZero=function(){var e=new t(this.sx,this.sy,this.depth,0);return e},t.prototype.get=function(t,e,a){var i=(this.sx*e+t)*this.depth+a;return this.w[i]},t.prototype.set=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.w[o]=i},t.prototype.add=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]+=i,this},t.prototype.sub=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]-=i,this},t.prototype.mul=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]*=i,this},t.prototype.div=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]/=i,this},t.prototype.get_grad=function(t,e,a){var i=(this.sx*e+t)*this.depth+a;return this.dw[i]},t.prototype.set_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]=i},t.prototype.add_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]+=i},t.prototype.sub_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]-=i},t.prototype.mul_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]*=i},t.prototype.div_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]/=i},t.prototype.roll=function(t,a,i){void 0===t&&(t=0),void 0===a&&(a=0),void 0===i&&(i=0);for(var o=this.clone(),n=0,r=o.depth;n<r;++n)for(var s=0,p=o.sx;s<p;++s)for(var l=0,u=o.sy;l<u;++l){var d=this.get(e.mod(s+t,this.sx),e.mod(l+a,this.sy),e.mod(n+i,this.depth));o.set(s,l,n,d)}return o},t.prototype.zoom=function(e,a,i){void 0===e&&(e=1),void 0===a&&(a=1),void 0===i&&(i=1);for(var o=new t(Math.round(this.sx*e),Math.round(this.sy*a),Math.round(this.depth*i),0),n=0,r=o.depth;n<r;++n)for(var s=0,p=o.sx;s<p;++s)for(var l=0,u=o.sy;l<u;++l){for(var d=0,h=Math.ceil(1/e),m=Math.ceil(1/a),f=Math.ceil(1/i),y=Math.ceil(s/e),_=Math.ceil(l/a),c=Math.ceil(n/i),v=Math.min(y+h,this.sx),g=Math.min(_+m,this.sy),w=Math.min(c+f,this.depth),P=y;P<v;P++)for(var N=_;N<g;N++)for(var x=c;x<w;x++){var b=this.get(P,N,x);o.add(s,l,n,b),d++}o.div(s,l,n,d)}return o},t.prototype.toJSON=function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},t.fromJSON=function(e){var a=new t(e.sx,e.sy,e.depth,0);return a.w.set(e.w),a},t}();t.Vol=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(){function t(){}return t.prototype.getLayer=function(t){return this.layers.get(t)},t.prototype.setInputDimensions=function(t,e,a){void 0===a&&(a=3),this.layerIterator(function(i,o,n){0===o?(i.in_sx=t,i.in_sy=e,i.in_depth=a,i.updateDimensions()):i.updateDimensions(n)})},t.prototype.layerIterator=function(t,e){var a=this;void 0===e&&(e={});var i,o=[],n=[],r=0,s=d3.set();void 0===e.reverse||e.reverse===!1?(i=e.start?this.layers.get(e.start):this.layers.get("data"),n=this.edges):(i=e.start?this.layers.get(e.start):this.layers.values()[this.layers.size()-1],n=this.edges.map(function(t){return{from:t.to,to:t.from}}));var p=d3.map(d3.nest().key(function(t){return t.from}).entries(n),function(t){return t.key}),l=d3.map(d3.nest().key(function(t){return t.to}).entries(n),function(t){return t.key});for(o.push(i);o.length;){var u=o.pop();s.add(u.name);var d=l.get(u.name),h=void 0===d?void 0:d.values.map(function(t){return a.layers.get(t.from)});if(t(u,r++,h),e.end&&u.name===e.end)break;var m=p.get(u.name);m&&m.values.filter(function(t){return!s.has(t.to)}).forEach(function(t){var e=l.get(t.to),i=void 0===e?[]:e.values.filter(function(t){return!s.has(t.from)});0===i.length&&o.push(a.layers.get(t.to))})}},t.prototype.forward=function(t,e,a){void 0===e&&(e=!1),void 0===a&&(a={});var i,o=d3.map();return this.layerIterator(function(a,n,r){i=void 0===r?t:r.length>1?r.map(function(t){return o.get(t.name)}):o.get(r[0].name),i=a.forward(i,e),o.set(a.name,i)},a),i},t.prototype.backward=function(t,e){void 0===e&&(e={}),e.reverse=!0;var a;return this.layerIterator(function(e,i,o){void 0!==t&&0===i?a=e.backward(t):e.backward()},e),a},t.prototype.debugStructure=function(){var t=0,a=d3.format("s"),i=d3.format(",d"),o=0;this.layerIterator(function(a,n,r){var s=e.sum(a.getNumParameters()),p="";p+=a.getOutputShape().join("x")+" :: ",p+=a.getDescription().join(" "),s&&(t+=s,p+=" => "+i(s)+" parameters"),o+=1,console.log(p)}),console.log("---"),console.log("Total number of layers "+i(o)),console.log("Total number of params "+i(t)+" (memory: "+a(4*t)+"b): ")},t}();t.Net=a}(Net||(Net={}));var Parser;!function(t){var e=function(){function t(){}return t.prototype.fetch=function(t){var e=new Request(t);return fetch(e).then(function(t){return t.text()})},t.prototype.parse=function(t){var e=this;return this.fetch(t).then(function(t){return e.parseString(t)})},t}();t.TextParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(){function t(){}return t.prototype.fetch=function(t){var e=new Request(t);return fetch(e).then(function(t){return t.arrayBuffer()})},t.prototype.parse=function(t){var e=this;return this.fetch(t).then(function(t){return e.parseBuffer(t)})},t}();t.BinaryParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parseString=function(t){return this.parsePrototxt(t)},e.prototype.parsePrototxt=function(t,e){void 0===e&&(e=0);var a,i={};if(0==e)var o=/(?:^|\n)(\w+):\s"*([\w\/.]+)"*/gi,n=/(?:^|\n)(\w+)\s\{([\S\s]*?)\n\}/gi;else var r="(?:^|\\n)\\s{"+e+"}",s="(\\w+)",o=new RegExp(r+s+'\\s*:\\s*"*([\\w/.]+)"*',"gi"),n=new RegExp(r+s+"\\s*\\{\\s*\\n([\\s\\S]*?)\\n\\s{"+e+"}\\}","gi");for(;a=o.exec(t);){var s=a[1],p=a[2];void 0!==i[s]?Array.isArray(i[s])?i[s].push(p):(i[s]=[i[s]],i[s].push(p)):i[a[1]]=p}for(;a=n.exec(t);){var s=a[1],p=this.parsePrototxt(a[2],e+2);void 0!==i[s]?Array.isArray(i[s])?i[s].push(p):(i[s]=[i[s]],i[s].push(p)):i[s]=p}return i},e}(t.TextParser);t.PrototxtParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parseBuffer=function(t){var e=dcodeIO.ProtoBuf.newBuilder({})["import"]({"package":"caffe",messages:[{name:"BlobShape",fields:[{rule:"repeated",type:"int64",name:"dim",id:1,options:{packed:!0}}]},{name:"BlobProto",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:7},{rule:"repeated",type:"float",name:"data",id:5,options:{packed:!0}},{rule:"repeated",type:"float",name:"diff",id:6,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_data",id:8,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_diff",id:9,options:{packed:!0}},{rule:"optional",type:"int32",name:"num",id:1,options:{"default":0}},{rule:"optional",type:"int32",name:"channels",id:2,options:{"default":0}},{rule:"optional",type:"int32",name:"height",id:3,options:{"default":0}},{rule:"optional",type:"int32",name:"width",id:4,options:{"default":0}}]},{name:"BlobProtoVector",fields:[{rule:"repeated",type:"BlobProto",name:"blobs",id:1}]},{name:"Datum",fields:[{rule:"optional",type:"int32",name:"channels",id:1},{rule:"optional",type:"int32",name:"height",id:2},{rule:"optional",type:"int32",name:"width",id:3},{rule:"optional",type:"bytes",name:"data",id:4},{rule:"optional",type:"int32",name:"label",id:5},{rule:"repeated",type:"float",name:"float_data",id:6},{rule:"optional",type:"bool",name:"encoded",id:7,options:{"default":!1}}]},{name:"FillerParameter",fields:[{rule:"optional",type:"string",name:"type",id:1,options:{"default":"constant"}},{rule:"optional",type:"float",name:"value",id:2,options:{"default":0}},{rule:"optional",type:"float",name:"min",id:3,options:{"default":0}},{rule:"optional",type:"float",name:"max",id:4,options:{"default":1}},{rule:"optional",type:"float",name:"mean",id:5,options:{"default":0}},{rule:"optional",type:"float",name:"std",id:6,options:{"default":1}},{rule:"optional",type:"int32",name:"sparse",id:7,options:{"default":-1}},{rule:"optional",type:"VarianceNorm",name:"variance_norm",id:8,options:{"default":"FAN_IN"}}],enums:[{name:"VarianceNorm",values:[{name:"FAN_IN",id:0},{name:"FAN_OUT",id:1},{name:"AVERAGE",id:2}]}]},{name:"NetParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"repeated",type:"string",name:"input",id:3},{rule:"repeated",type:"BlobShape",name:"input_shape",id:8},{rule:"repeated",type:"int32",name:"input_dim",id:4},{rule:"optional",type:"bool",name:"force_backward",id:5,options:{"default":!1}},{rule:"optional",type:"NetState",name:"state",id:6},{rule:"optional",type:"bool",name:"debug_info",id:7,options:{"default":!1}},{rule:"repeated",type:"LayerParameter",name:"layer",id:100},{rule:"repeated",type:"V1LayerParameter",name:"layers",id:2}]},{name:"SolverParameter",fields:[{rule:"optional",type:"string",name:"net",id:24},{rule:"optional",type:"NetParameter",name:"net_param",id:25},{rule:"optional",type:"string",name:"train_net",id:1},{rule:"repeated",type:"string",name:"test_net",id:2},{rule:"optional",type:"NetParameter",name:"train_net_param",id:21},{rule:"repeated",type:"NetParameter",name:"test_net_param",id:22},{rule:"optional",type:"NetState",name:"train_state",id:26},{rule:"repeated",type:"NetState",name:"test_state",id:27},{rule:"repeated",type:"int32",name:"test_iter",id:3},{rule:"optional",type:"int32",name:"test_interval",id:4,options:{"default":0}},{rule:"optional",type:"bool",name:"test_compute_loss",id:19,options:{"default":!1}},{rule:"optional",type:"bool",name:"test_initialization",id:32,options:{"default":!0}},{rule:"optional",type:"float",name:"base_lr",id:5},{rule:"optional",type:"int32",name:"display",id:6},{rule:"optional",type:"int32",name:"average_loss",id:33,options:{"default":1}},{rule:"optional",type:"int32",name:"max_iter",id:7},{rule:"optional",type:"int32",name:"iter_size",id:36,options:{"default":1}},{rule:"optional",type:"string",name:"lr_policy",id:8},{rule:"optional",type:"float",name:"gamma",id:9},{rule:"optional",type:"float",name:"power",id:10},{rule:"optional",type:"float",name:"momentum",id:11},{rule:"optional",type:"float",name:"weight_decay",id:12},{rule:"optional",type:"string",name:"regularization_type",id:29,options:{"default":"L2"}},{rule:"optional",type:"int32",name:"stepsize",id:13},{rule:"repeated",type:"int32",name:"stepvalue",id:34},{rule:"optional",type:"float",name:"clip_gradients",id:35,options:{"default":-1}},{rule:"optional",type:"int32",name:"snapshot",id:14,options:{"default":0}},{rule:"optional",type:"string",name:"snapshot_prefix",id:15},{rule:"optional",type:"bool",name:"snapshot_diff",id:16,options:{"default":!1}},{rule:"optional",type:"SnapshotFormat",name:"snapshot_format",id:37,options:{"default":"BINARYPROTO"}},{rule:"optional",type:"SolverMode",name:"solver_mode",id:17,options:{"default":"GPU"}},{rule:"optional",type:"int32",name:"device_id",id:18,options:{"default":0}},{rule:"optional",type:"int64",name:"random_seed",id:20,options:{"default":-1}},{rule:"optional",type:"string",name:"type",id:40,options:{"default":"SGD"}},{rule:"optional",type:"float",name:"delta",id:31,options:{"default":1e-8}},{rule:"optional",type:"float",name:"momentum2",id:39,options:{"default":.999}},{rule:"optional",type:"float",name:"rms_decay",id:38},{rule:"optional",type:"bool",name:"debug_info",id:23,options:{"default":!1}},{rule:"optional",type:"bool",name:"snapshot_after_train",id:28,options:{"default":!0}},{rule:"optional",type:"SolverType",name:"solver_type",id:30,options:{"default":"SGD"}}],enums:[{name:"SnapshotFormat",values:[{name:"HDF5",id:0},{name:"BINARYPROTO",id:1}]},{name:"SolverMode",values:[{name:"CPU",id:0},{name:"GPU",id:1}]},{name:"SolverType",values:[{name:"SGD",id:0},{name:"NESTEROV",id:1},{name:"ADAGRAD",id:2},{name:"RMSPROP",id:3},{name:"ADADELTA",id:4},{name:"ADAM",id:5}]}]},{name:"SolverState",fields:[{rule:"optional",type:"int32",name:"iter",id:1},{rule:"optional",type:"string",name:"learned_net",id:2},{rule:"repeated",type:"BlobProto",name:"history",id:3},{rule:"optional",type:"int32",name:"current_step",id:4,options:{"default":0}}]},{name:"NetState",fields:[{rule:"optional",type:"Phase",name:"phase",id:1,options:{"default":"TEST"}},{rule:"optional",type:"int32",name:"level",id:2,options:{"default":0}},{rule:"repeated",type:"string",name:"stage",id:3}]},{name:"NetStateRule",fields:[{rule:"optional",type:"Phase",name:"phase",id:1},{rule:"optional",type:"int32",name:"min_level",id:2},{rule:"optional",type:"int32",name:"max_level",id:3},{rule:"repeated",type:"string",name:"stage",id:4},{rule:"repeated",type:"string",name:"not_stage",id:5}]},{name:"ParamSpec",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"DimCheckMode",name:"share_mode",id:2},{rule:"optional",type:"float",name:"lr_mult",id:3,options:{"default":1}},{rule:"optional",type:"float",name:"decay_mult",id:4,options:{"default":1}}],enums:[{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"repeated",type:"string",name:"bottom",id:3},{rule:"repeated",type:"string",name:"top",id:4},{rule:"optional",type:"Phase",name:"phase",id:10},{rule:"repeated",type:"float",name:"loss_weight",id:5},{rule:"repeated",type:"ParamSpec",name:"param",id:6},{rule:"repeated",type:"BlobProto",name:"blobs",id:7},{rule:"repeated",type:"bool",name:"propagate_down",id:11},{rule:"repeated",type:"NetStateRule",name:"include",id:8},{rule:"repeated",type:"NetStateRule",name:"exclude",id:9},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:100},{rule:"optional",type:"LossParameter",name:"loss_param",id:101},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:102},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:103},{rule:"optional",type:"BatchNormParameter",name:"batch_norm_param",id:139},{rule:"optional",type:"BiasParameter",name:"bias_param",id:141},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:104},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:105},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:106},{rule:"optional",type:"CropParameter",name:"crop_param",id:144},{rule:"optional",type:"DataParameter",name:"data_param",id:107},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:108},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:109},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:110},{rule:"optional",type:"ELUParameter",name:"elu_param",id:140},{rule:"optional",type:"EmbedParameter",name:"embed_param",id:137},{rule:"optional",type:"ExpParameter",name:"exp_param",id:111},{rule:"optional",type:"FlattenParameter",name:"flatten_param",id:135},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:112},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:113},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:114},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:115},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:116},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:117},{rule:"optional",type:"InputParameter",name:"input_param",id:143},{rule:"optional",type:"LogParameter",name:"log_param",id:134},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:118},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:119},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:120},{rule:"optional",type:"ParameterParameter",name:"parameter_param",id:145},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:121},{rule:"optional",type:"PowerParameter",name:"power_param",id:122},{rule:"optional",type:"PReLUParameter",name:"prelu_param",id:131},{rule:"optional",type:"PythonParameter",name:"python_param",id:130},{rule:"optional",type:"ReductionParameter",name:"reduction_param",id:136},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:123},{rule:"optional",type:"ReshapeParameter",name:"reshape_param",id:133},{rule:"optional",type:"ScaleParameter",name:"scale_param",id:142},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:124},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:125},{rule:"optional",type:"SPPParameter",name:"spp_param",id:132},{rule:"optional",type:"SliceParameter",name:"slice_param",id:126},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:127},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:128},{rule:"optional",type:"TileParameter",name:"tile_param",id:138},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:129}]},{name:"TransformationParameter",fields:[{rule:"optional",type:"float",name:"scale",id:1,options:{"default":1}},{rule:"optional",type:"bool",name:"mirror",id:2,options:{"default":!1}},{rule:"optional",type:"uint32",name:"crop_size",id:3,options:{"default":0}},{rule:"optional",type:"string",name:"mean_file",id:4},{rule:"repeated",type:"float",name:"mean_value",id:5},{rule:"optional",type:"bool",name:"force_color",id:6,options:{"default":!1}},{rule:"optional",type:"bool",name:"force_gray",id:7,options:{"default":!1}}]},{name:"LossParameter",fields:[{rule:"optional",type:"int32",name:"ignore_label",id:1},{rule:"optional",type:"NormalizationMode",name:"normalization",id:3,options:{"default":"VALID"}},{rule:"optional",type:"bool",name:"normalize",id:2}],enums:[{name:"NormalizationMode",values:[{name:"FULL",id:0},{name:"VALID",id:1},{name:"BATCH_SIZE",id:2},{name:"NONE",id:3}]}]},{name:"AccuracyParameter",fields:[{rule:"optional",type:"uint32",name:"top_k",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}},{rule:"optional",type:"int32",name:"ignore_label",id:3}]},{name:"ArgMaxParameter",fields:[{rule:"optional",type:"bool",name:"out_max_val",id:1,options:{"default":!1}},{rule:"optional",type:"uint32",name:"top_k",id:2,options:{"default":1}},{rule:"optional",type:"int32",name:"axis",id:3}]},{name:"ConcatParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}},{rule:"optional",type:"uint32",name:"concat_dim",id:1,options:{"default":1}}]},{name:"BatchNormParameter",fields:[{rule:"optional",type:"bool",name:"use_global_stats",id:1},{rule:"optional",type:"float",name:"moving_average_fraction",id:2,options:{"default":.999}},{rule:"optional",type:"float",name:"eps",id:3,options:{"default":1e-5}}]},{name:"BiasParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3}]},{name:"ContrastiveLossParameter",fields:[{rule:"optional",type:"float",name:"margin",id:1,options:{"default":1}},{rule:"optional",type:"bool",name:"legacy_version",id:2,options:{"default":!1}}]},{name:"ConvolutionParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{"default":!0}},{rule:"repeated",type:"uint32",name:"pad",id:3},{rule:"repeated",type:"uint32",name:"kernel_size",id:4},{rule:"repeated",type:"uint32",name:"stride",id:6},{rule:"repeated",type:"uint32",name:"dilation",id:18},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernel_h",id:11},{rule:"optional",type:"uint32",name:"kernel_w",id:12},{rule:"optional",type:"uint32",name:"stride_h",id:13},{rule:"optional",type:"uint32",name:"stride_w",id:14},{rule:"optional",type:"uint32",name:"group",id:5,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:7},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:8},{rule:"optional",type:"Engine",name:"engine",id:15,options:{"default":"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:16,options:{"default":1}},{rule:"optional",type:"bool",name:"force_nd_im2col",id:17,options:{"default":!1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"CropParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":2}},{rule:"repeated",type:"uint32",name:"offset",id:2}]},{name:"DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{"default":0}},{rule:"optional",type:"DB",name:"backend",id:8,options:{"default":"LEVELDB"}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"bool",name:"force_encoded_color",id:9,options:{"default":!1}},{rule:"optional",type:"uint32",name:"prefetch",id:10,options:{"default":4}}],enums:[{name:"DB",values:[{name:"LEVELDB",id:0},{name:"LMDB",id:1}]}]},{name:"DropoutParameter",fields:[{rule:"optional",type:"float",name:"dropout_ratio",id:1,options:{"default":.5}}]},{name:"DummyDataParameter",fields:[{rule:"repeated",type:"FillerParameter",name:"data_filler",id:1},{rule:"repeated",type:"BlobShape",name:"shape",id:6},{rule:"repeated",type:"uint32",name:"num",id:2},{rule:"repeated",type:"uint32",name:"channels",id:3},{rule:"repeated",type:"uint32",name:"height",id:4},{rule:"repeated",type:"uint32",name:"width",id:5}]},{name:"EltwiseParameter",fields:[{rule:"optional",type:"EltwiseOp",name:"operation",id:1,options:{"default":"SUM"}},{rule:"repeated",type:"float",name:"coeff",id:2},{rule:"optional",type:"bool",name:"stable_prod_grad",id:3,options:{"default":!0}}],enums:[{name:"EltwiseOp",values:[{name:"PROD",id:0},{name:"SUM",id:1},{name:"MAX",id:2}]}]},{name:"ELUParameter",fields:[{rule:"optional",type:"float",name:"alpha",id:1,options:{"default":1}}]},{name:"EmbedParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"uint32",name:"input_dim",id:2},{rule:"optional",type:"bool",name:"bias_term",id:3,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:4},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"ExpParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{"default":-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"FlattenParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"end_axis",id:2,options:{"default":-1}}]},{name:"HDF5DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:2},{rule:"optional",type:"bool",name:"shuffle",id:3,options:{"default":!1}}]},{name:"HDF5OutputParameter",fields:[{rule:"optional",type:"string",name:"file_name",id:1}]},{name:"HingeLossParameter",fields:[{rule:"optional",type:"Norm",name:"norm",id:1,options:{"default":"L1"}}],enums:[{name:"Norm",values:[{name:"L1",id:1},{name:"L2",id:2}]}]},{name:"ImageDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4,options:{"default":1}},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{"default":0}},{rule:"optional",type:"bool",name:"shuffle",id:8,options:{"default":!1}},{rule:"optional",type:"uint32",name:"new_height",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"new_width",id:10,options:{"default":0}},{rule:"optional",type:"bool",name:"is_color",id:11,options:{"default":!0}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"string",name:"root_folder",id:12,options:{"default":""}}]},{name:"InfogainLossParameter",fields:[{rule:"optional",type:"string",name:"source",id:1}]},{name:"InnerProductParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:3},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:4},{rule:"optional",type:"int32",name:"axis",id:5,options:{"default":1}},{rule:"optional",type:"bool",name:"transpose",id:6,options:{"default":!1}}]},{name:"InputParameter",fields:[{rule:"repeated",type:"BlobShape",name:"shape",id:1}]},{name:"LogParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{"default":-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"LRNParameter",fields:[{rule:"optional",type:"uint32",name:"local_size",id:1,options:{"default":5}},{rule:"optional",type:"float",name:"alpha",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"beta",id:3,options:{"default":.75}},{rule:"optional",type:"NormRegion",name:"norm_region",id:4,options:{"default":"ACROSS_CHANNELS"}},{rule:"optional",type:"float",name:"k",id:5,options:{"default":1}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{"default":"DEFAULT"}}],enums:[{name:"NormRegion",values:[{name:"ACROSS_CHANNELS",id:0},{name:"WITHIN_CHANNEL",id:1}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"MemoryDataParameter",fields:[{rule:"optional",type:"uint32",name:"batch_size",id:1},{rule:"optional",type:"uint32",name:"channels",id:2},{rule:"optional",type:"uint32",name:"height",id:3},{rule:"optional",type:"uint32",name:"width",id:4}]},{name:"MVNParameter",fields:[{rule:"optional",type:"bool",name:"normalize_variance",id:1,options:{"default":!0}},{rule:"optional",type:"bool",name:"across_channels",id:2,options:{"default":!1}},{rule:"optional",type:"float",name:"eps",id:3,options:{"default":1e-9}}]},{name:"ParameterParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1}]},{name:"PoolingParameter",fields:[{rule:"optional",type:"PoolMethod",name:"pool",id:1,options:{"default":"MAX"}},{rule:"optional",type:"uint32",name:"pad",id:4,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernel_size",id:2},{rule:"optional",type:"uint32",name:"kernel_h",id:5},{rule:"optional",type:"uint32",name:"kernel_w",id:6},{rule:"optional",type:"uint32",name:"stride",id:3,options:{"default":1}},{rule:"optional",type:"uint32",name:"stride_h",id:7},{rule:"optional",type:"uint32",name:"stride_w",id:8},{rule:"optional",type:"Engine",name:"engine",id:11,options:{"default":"DEFAULT"}},{rule:"optional",type:"bool",name:"global_pooling",id:12,options:{"default":!1}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"PowerParameter",fields:[{rule:"optional",type:"float",name:"power",id:1,options:{"default":1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"PythonParameter",fields:[{rule:"optional",type:"string",name:"module",id:1},{rule:"optional",type:"string",name:"layer",id:2},{rule:"optional",type:"string",name:"param_str",id:3,options:{"default":""}},{rule:"optional",type:"bool",name:"share_in_parallel",id:4,options:{"default":!1}}]},{name:"ReductionParameter",fields:[{rule:"optional",type:"ReductionOp",name:"operation",id:1,options:{"default":"SUM"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":0}},{rule:"optional",type:"float",name:"coeff",id:3,options:{"default":1}}],enums:[{name:"ReductionOp",values:[{name:"SUM",id:1},{name:"ASUM",id:2},{name:"SUMSQ",id:3},{name:"MEAN",id:4}]}]},{name:"ReLUParameter",fields:[{rule:"optional",type:"float",name:"negative_slope",id:1,options:{"default":0}},{rule:"optional",type:"Engine",name:"engine",id:2,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",
id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"ReshapeParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":0}},{rule:"optional",type:"int32",name:"num_axes",id:3,options:{"default":-1}}]},{name:"ScaleParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3},{rule:"optional",type:"bool",name:"bias_term",id:4,options:{"default":!1}},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"SigmoidParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"SliceParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:3,options:{"default":1}},{rule:"repeated",type:"uint32",name:"slice_point",id:2},{rule:"optional",type:"uint32",name:"slice_dim",id:1,options:{"default":1}}]},{name:"SoftmaxParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TanHParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TileParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"tiles",id:2}]},{name:"ThresholdParameter",fields:[{rule:"optional",type:"float",name:"threshold",id:1,options:{"default":0}}]},{name:"WindowDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"float",name:"fg_threshold",id:7,options:{"default":.5}},{rule:"optional",type:"float",name:"bg_threshold",id:8,options:{"default":.5}},{rule:"optional",type:"float",name:"fg_fraction",id:9,options:{"default":.25}},{rule:"optional",type:"uint32",name:"context_pad",id:10,options:{"default":0}},{rule:"optional",type:"string",name:"crop_mode",id:11,options:{"default":"warp"}},{rule:"optional",type:"bool",name:"cache_images",id:12,options:{"default":!1}},{rule:"optional",type:"string",name:"root_folder",id:13,options:{"default":""}}]},{name:"SPPParameter",fields:[{rule:"optional",type:"uint32",name:"pyramid_height",id:1},{rule:"optional",type:"PoolMethod",name:"pool",id:2,options:{"default":"MAX"}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{"default":"DEFAULT"}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"V1LayerParameter",fields:[{rule:"repeated",type:"string",name:"bottom",id:2},{rule:"repeated",type:"string",name:"top",id:3},{rule:"optional",type:"string",name:"name",id:4},{rule:"repeated",type:"NetStateRule",name:"include",id:32},{rule:"repeated",type:"NetStateRule",name:"exclude",id:33},{rule:"optional",type:"LayerType",name:"type",id:5},{rule:"repeated",type:"BlobProto",name:"blobs",id:6},{rule:"repeated",type:"string",name:"param",id:1001},{rule:"repeated",type:"DimCheckMode",name:"blob_share_mode",id:1002},{rule:"repeated",type:"float",name:"blobs_lr",id:7},{rule:"repeated",type:"float",name:"weight_decay",id:8},{rule:"repeated",type:"float",name:"loss_weight",id:35},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:27},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:23},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:9},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:40},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:10},{rule:"optional",type:"DataParameter",name:"data_param",id:11},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:12},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:26},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:24},{rule:"optional",type:"ExpParameter",name:"exp_param",id:41},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:13},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:14},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:29},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:15},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:16},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:17},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:18},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:22},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:34},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:19},{rule:"optional",type:"PowerParameter",name:"power_param",id:21},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:30},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:38},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:39},{rule:"optional",type:"SliceParameter",name:"slice_param",id:31},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:37},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:25},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:20},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:36},{rule:"optional",type:"LossParameter",name:"loss_param",id:42},{rule:"optional",type:"V0LayerParameter",name:"layer",id:1}],enums:[{name:"LayerType",values:[{name:"NONE",id:0},{name:"ABSVAL",id:35},{name:"ACCURACY",id:1},{name:"ARGMAX",id:30},{name:"BNLL",id:2},{name:"CONCAT",id:3},{name:"CONTRASTIVE_LOSS",id:37},{name:"CONVOLUTION",id:4},{name:"DATA",id:5},{name:"DECONVOLUTION",id:39},{name:"DROPOUT",id:6},{name:"DUMMY_DATA",id:32},{name:"EUCLIDEAN_LOSS",id:7},{name:"ELTWISE",id:25},{name:"EXP",id:38},{name:"FLATTEN",id:8},{name:"HDF5_DATA",id:9},{name:"HDF5_OUTPUT",id:10},{name:"HINGE_LOSS",id:28},{name:"IM2COL",id:11},{name:"IMAGE_DATA",id:12},{name:"INFOGAIN_LOSS",id:13},{name:"INNER_PRODUCT",id:14},{name:"LRN",id:15},{name:"MEMORY_DATA",id:29},{name:"MULTINOMIAL_LOGISTIC_LOSS",id:16},{name:"MVN",id:34},{name:"POOLING",id:17},{name:"POWER",id:26},{name:"RELU",id:18},{name:"SIGMOID",id:19},{name:"SIGMOID_CROSS_ENTROPY_LOSS",id:27},{name:"SILENCE",id:36},{name:"SOFTMAX",id:20},{name:"SOFTMAX_LOSS",id:21},{name:"SPLIT",id:22},{name:"SLICE",id:33},{name:"TANH",id:23},{name:"WINDOW_DATA",id:24},{name:"THRESHOLD",id:31}]},{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"V0LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"uint32",name:"num_output",id:3},{rule:"optional",type:"bool",name:"biasterm",id:4,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:5},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:6},{rule:"optional",type:"uint32",name:"pad",id:7,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernelsize",id:8},{rule:"optional",type:"uint32",name:"group",id:9,options:{"default":1}},{rule:"optional",type:"uint32",name:"stride",id:10,options:{"default":1}},{rule:"optional",type:"PoolMethod",name:"pool",id:11,options:{"default":"MAX"}},{rule:"optional",type:"float",name:"dropout_ratio",id:12,options:{"default":.5}},{rule:"optional",type:"uint32",name:"local_size",id:13,options:{"default":5}},{rule:"optional",type:"float",name:"alpha",id:14,options:{"default":1}},{rule:"optional",type:"float",name:"beta",id:15,options:{"default":.75}},{rule:"optional",type:"float",name:"k",id:22,options:{"default":1}},{rule:"optional",type:"string",name:"source",id:16},{rule:"optional",type:"float",name:"scale",id:17,options:{"default":1}},{rule:"optional",type:"string",name:"meanfile",id:18},{rule:"optional",type:"uint32",name:"batchsize",id:19},{rule:"optional",type:"uint32",name:"cropsize",id:20,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:21,options:{"default":!1}},{rule:"repeated",type:"BlobProto",name:"blobs",id:50},{rule:"repeated",type:"float",name:"blobs_lr",id:51},{rule:"repeated",type:"float",name:"weight_decay",id:52},{rule:"optional",type:"uint32",name:"rand_skip",id:53,options:{"default":0}},{rule:"optional",type:"float",name:"det_fg_threshold",id:54,options:{"default":.5}},{rule:"optional",type:"float",name:"det_bg_threshold",id:55,options:{"default":.5}},{rule:"optional",type:"float",name:"det_fg_fraction",id:56,options:{"default":.25}},{rule:"optional",type:"uint32",name:"det_context_pad",id:58,options:{"default":0}},{rule:"optional",type:"string",name:"det_crop_mode",id:59,options:{"default":"warp"}},{rule:"optional",type:"int32",name:"new_num",id:60,options:{"default":0}},{rule:"optional",type:"int32",name:"new_channels",id:61,options:{"default":0}},{rule:"optional",type:"int32",name:"new_height",id:62,options:{"default":0}},{rule:"optional",type:"int32",name:"new_width",id:63,options:{"default":0}},{rule:"optional",type:"bool",name:"shuffle_images",id:64,options:{"default":!1}},{rule:"optional",type:"uint32",name:"concat_dim",id:65,options:{"default":1}},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:1001}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]}]},{name:"PReLUParameter",fields:[{rule:"optional",type:"FillerParameter",name:"filler",id:1},{rule:"optional",type:"bool",name:"channel_shared",id:2,options:{"default":!1}}]}],enums:[{name:"Phase",values:[{name:"TRAIN",id:0},{name:"TEST",id:1}]}]}).build();return this.parseProto(t,e.caffe)},e}(t.BinaryParser);t.BinaryprotoParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parseProto=function(t,e){for(var a=e.BlobProto.decode(t),i=a.width,o=a.height,n=a.channels,r=a.data,s=new Net.Vol(i,o,n,0),p=0;p<n;p++)for(var l=0;l<o;l++)for(var u=0;u<i;u++){var d=(o*p+l)*i+u;s.set(u,l,p,r[d])}return s},e}(t.BinaryprotoParser);t.BlobProtoParser=e}(Parser||(Parser={}));var Net;!function(t){function e(t,e){for(var a=r.randf(0,1),i=0,o=0,n=t.length;o<n;o++)if(i+=e[o],a<i)return t[o]}function a(t,e,a){if(void 0===t&&(t={}),"string"==typeof e)return void 0!==t[e]?t[e]:a;var i=a;return e.forEach(function(e){i=void 0!==t[e]?t[e]:i}),i}function i(t,e){if(!t){if(e=e||"Assertion failed","undefined"!=typeof Error)throw new Error(e);throw e}}function o(t,e){for(var a=0,i=t.length;a<i;a++)if(t[a]===e)return!0;return!1}function n(t){for(var e=[],a=0,i=t.length;a<i;a++)o(e,t[a])||e.push(t[a]);return e}var r=NumJS;t.weightedSample=e,t.getopt=a,t.assert=i,t.arrContains=o,t.arrUnique=n}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(){function t(t){this.in_depth=1,this.in_sy=1,this.in_sx=1,this.out_depth=1,this.out_sy=1,this.out_sx=1,this.name=void 0!==t.name?t.name:"",this.input=void 0!==t.input?t.input:void 0,this.output=void 0!==t.output?t.output:void 0,t.pred||(this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.in_depth=t.in_depth)}return t.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=this.in_depth},t.prototype.resetGradient=function(){if(this.in_act instanceof Array)for(var t=0;t<this.in_act.length;t++)this.in_act[t].dw=e.zeros(this.in_act[t].w.length);else this.in_act.dw=e.zeros(this.in_act.w.length)},t.prototype.getNumParameters=function(){return[0,0]},t.prototype.getOutputShape=function(){return[this.in_depth,this.in_sy,this.in_sx]},t.prototype.getDescription=function(){return[this.layer_type.toUpperCase(),this.name]},t.prototype.getParamsAndGrads=function(){return[]},t.prototype.toJSON=function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.name=this.name,t.output=this.output,t.input=this.input,t},t.prototype.fromJSON=function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.name=t.name,this.output=t.output,this.input=t.input},t}();t.BaseLayer=a}(Net||(Net={}));var Net;!function(t){var e=function(e){function a(a){e.call(this,a||{}),this.layer_type="input",this.in_depth=t.getopt(a,["in_depth","out_depth","depth"],0),this.in_sx=t.getopt(a,["in_sx","out_sx","sx","width"],1),this.in_sy=t.getopt(a,["in_sy","out_sy","sy","height"],1),this.updateDimensions()}return __extends(a,e),a.prototype.forward=function(t,e){return this.in_act=t,this.resetGradient(),this.out_act=t,this.out_act},a.prototype.backward=function(){},a}(t.BaseLayer);t.InputLayer=e}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="concat",this.axis=t.getopt(e,["axis"],1),this.updateDimensions(e.pred)}return __extends(i,a),i.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();var i=new t.Vol(this.out_sx,this.out_sy,this.out_depth,0),o=0;if(0===this.axis)for(var n=i.w,r=0;r<e.length;r++)n.set(e[r].w,o),o+=e[r].w.length;else for(var s=0;s<e.length;s++){for(var p=e[s],l=0;l<p.depth;l++)for(var u=0;u<p.sx;u++)for(var d=0;d<p.sy;d++)i.set(u,d,l+o,p.get(u,d,l));o+=p.depth}return this.out_act=i,this.out_act},i.prototype.backward=function(){var t=this.in_act,a=this.out_act,i=0;if(0===this.axis)for(var o=a.dw,n=0;n<t.length;n++){var r=t[n].dw;r=e.add(r,o.slice(i,i+r.length)),i+=r.length}else for(var n=0,s=t.length;n<s;++n){for(var p=t[n],r=t[n].dw,l=0,u=p.depth;l<u;++l)for(var d=0,h=p.sx;d<h;++d)for(var m=0,f=p.sy;m<f;++m)p.add_grad(d,m,l,a.get_grad(d,m,l+i));i+=p.depth}},i.prototype.updateDimensions=function(t){t&&(0==this.axis?(this.in_sx=t[0].in_sx,this.in_sy=t[0].in_sy,this.in_depth=t[0].in_depth):(this.in_sx=t[0].in_sx,this.in_sy=t[0].in_sy,this.in_depth=e.sum(t.map(function(t){return t.out_depth})))),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=this.in_depth},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.axis=this.axis,t},i.prototype.fromJSON=function(t){a.prototype.fromJSON.call(this,t),this.axis=t.axis},i}(t.BaseLayer);t.ConcatLayer=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="conv",this.out_depth=e.filters,this.sx=e.sx,this.sy=t.getopt(e,["sy"],this.sx),this.stride=t.getopt(e,["stride"],1),this.pad=t.getopt(e,["pad"],0),this.l1_decay_mul=t.getopt(e,["l1_decay_mul"],0),this.l2_decay_mul=t.getopt(e,["l2_decay_mul"],1),this.updateDimensions(e.pred);var i=t.getopt(e,["bias_pref"],0);this.biases=new t.Vol(1,1,this.out_depth,i),this.filters=[];for(var o=0;o<this.out_depth;++o)this.filters.push(new t.Vol(this.sx,this.sy,this.in_depth,0))}return __extends(i,a),i.prototype.resetGradient=function(){a.prototype.resetGradient.call(this);for(var t=0;t<this.out_depth;++t)this.filters[t].dw=e.zeros(this.filters[t].w.length);this.biases.dw=e.zeros(this.out_depth)},i.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();for(var i=new t.Vol(0|this.out_sx,0|this.out_sy,0|this.out_depth,0),o=0|e.sx,n=0|e.sy,r=0|this.stride,s=0;s<this.out_depth;++s)for(var p=this.filters[s],l=0|-this.pad,u=0|-this.pad,d=0;d<this.out_sy;u+=r,++d){l=0|-this.pad;for(var h=0;h<this.out_sx;l+=r,++h){for(var m=0,f=0;f<p.sy;++f)for(var y=u+f,_=0;_<p.sx;++_){var c=l+_;if(y>=0&&y<n&&c>=0&&c<o)for(var v=0;v<p.depth;++v)m+=p.w[(p.sx*f+_)*p.depth+v]*e.w[(o*y+c)*e.depth+v]}m+=this.biases.w[s],i.set(h,d,s,m)}}return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var t=this.in_act,e=0|t.sx,a=0|t.sy,i=0|this.stride,o=0;o<this.out_depth;++o)for(var n=this.filters[o],r=0|-this.pad,s=0|-this.pad,p=0;p<this.out_sy;s+=i,++p){r=0|-this.pad;for(var l=0;l<this.out_sx;r+=i,++l){for(var u=this.out_act.get_grad(l,p,o),d=0;d<n.sy;++d)for(var h=s+d,m=0;m<n.sx;++m){var f=r+m;if(h>=0&&h<a&&f>=0&&f<e)for(var y=0;y<n.depth;++y){var _=(e*h+f)*t.depth+y,c=(n.sx*d+m)*n.depth+y;n.dw[c]+=t.w[_]*u,t.dw[_]+=n.w[c]*u}}this.biases.dw[o]+=u}}},i.prototype.getParamsAndGrads=function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth);var e=this.getOutputShape();this.out_sx=e[1],this.out_sy=e[2]},i.prototype.getNumParameters=function(){return[this.in_depth*this.sx*this.sy*this.out_depth,this.out_depth]},i.prototype.getOutputShape=function(){return[this.out_depth,Math.round((this.in_sx+2*this.pad-this.sx)/this.stride+1),Math.round((this.in_sy+2*this.pad-this.sy)/this.stride+1)]},i.prototype.getDescription=function(){return a.prototype.getDescription.call(this).concat([[this.out_depth,this.sy,this.sx].join("x")+" Stride "+this.stride+" Pad "+this.pad])},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.sx=e.sx,this.sy=e.sy,this.stride=e.stride,this.in_depth=e.in_depth,this.filters=[],this.l1_decay_mul=void 0!==e.l1_decay_mul?e.l1_decay_mul:0,this.l2_decay_mul=void 0!==e.l2_decay_mul?e.l2_decay_mul:1,this.pad=void 0!==e.pad?e.pad:0;for(var i=0;i<e.filters.length;i++)this.filters.push(t.Vol.fromJSON(e.filters[i]));this.biases=t.Vol.fromJSON(e.biases)},i}(t.BaseLayer);t.ConvLayer=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="pool",this.out_depth=e.filters,this.sx=e.sx,this.pool=t.getopt(e,["pool"],"MAX"),this.sy=t.getopt(e,["sy"],this.sx),this.stride=t.getopt(e,["stride"],1),this.pad=t.getopt(e,["pad"],0),this.updateDimensions(e.pred)}return __extends(i,a),i.prototype.forward=function(a,i){this.in_act=a,this.resetGradient(),this.switchx=e.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=e.zeros(this.out_sx*this.out_sy*this.out_depth);var o=new t.Vol(this.out_sx,this.out_sy,this.out_depth,0);if("AVE"===this.pool)for(var n=(this.sx*this.sy,0);n<this.out_depth;++n)for(var r=0;r<this.out_sx;++r)for(var s=0;s<this.out_sy;++s){var p=0,l=r*this.stride-this.pad,u=s*this.stride-this.pad,d=Math.min(l+this.sx,a.sx+this.pad),h=Math.min(u+this.sy,a.sy+this.pad);l=Math.max(l,0),u=Math.max(u,0),d=Math.min(d,a.sx),h=Math.min(h,a.sy);for(var m=(d-l)*(h-u),f=l;f<d;++f)for(var y=u;y<h;++y)p+=a.get(f,y,n);o.set(r,s,n,p/m)}else for(var _=0,c=0;c<this.out_depth;++c)for(var v=-this.pad,g=-this.pad,w=0;w<this.out_sx;v+=this.stride,w++){g=-this.pad;for(var P=0;P<this.out_sy;g+=this.stride,P++){for(var N=-99999,x=-1,b=-1,S=0;S<this.sx;++S)for(var L=0;L<this.sy;++L){var A=g+L,D=v+S;if(A>=0&&A<a.sy&&D>=0&&D<a.sx){var E=a.get(D,A,c);E>N&&(N=E,x=D,b=A)}}this.switchx[_]=x,this.switchy[_]=b,_++,o.set(w,P,c,N)}}return this.out_act=o,this.out_act},i.prototype.backward=function(){var t=this.in_act;this.out_act;if("AVE"===this.pool);else for(var e=0,a=0;a<this.out_depth;++a)for(var i=-this.pad,o=0;o<this.out_sx;i+=this.stride,o++)for(var n=-this.pad,r=0;r<this.out_sy;n+=this.stride,r++){var s=this.out_act.get_grad(o,r,a);t.add_grad(this.switchx[e],this.switchy[e],a,s),e++}},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth);var e=this.getOutputShape();this.out_sx=e[1],this.out_sy=e[2],this.out_depth=this.in_depth},i.prototype.getOutputShape=function(){return[this.out_depth,Math.ceil((this.in_sx+2*this.pad-this.sx)/this.stride+1),Math.ceil((this.in_sy+2*this.pad-this.sy)/this.stride+1)]},i.prototype.getDescription=function(){return[this.pool+" "+this.layer_type.toUpperCase(),this.name,[this.sy,this.sx].join("x")+" Stride "+this.stride+" Pad "+this.pad]},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.pool=this.pool,t.in_depth=this.in_depth,t.pad=this.pad,t},i.prototype.fromJSON=function(t){a.prototype.fromJSON.call(this,t),this.pool=void 0!==t.pool?t.pool:"MAX",this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.pad=void 0!==t.pad?t.pad:0,this.switchx=e.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array),this.switchy=e.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array)},i}(t.BaseLayer);t.PoolLayer=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="fc",this.sx=1,this.sy=1,this.out_depth=void 0!==e.num_neurons?e.num_neurons:e.filters,this.l1_decay_mul=t.getopt(e,["l1_decay_mul"],0),this.l2_decay_mul=t.getopt(e,["l2_decay_mul"],1),this.updateDimensions(e.pred);var i=t.getopt(e,["bias_pref"],0);this.biases=new t.Vol(1,1,this.out_depth,i),this.filters=[];for(var o=0;o<this.out_depth;++o)this.filters.push(new t.Vol(1,1,this.num_inputs,0));if(void 0!==e.filters)for(var o=0;o<this.out_depth;++o)this.filters[o].w.set(e.filters[o]);void 0!==e.biases&&this.biases.w.set(e.biases)}return __extends(i,a),i.prototype.resetGradient=function(){a.prototype.resetGradient.call(this);for(var t=0;t<this.out_depth;++t)this.filters[t].dw=e.zeros(this.filters[t].w.length);this.biases.dw=e.zeros(this.out_depth)},i.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();for(var i=new t.Vol(1,1,this.out_depth,0),o=e.w,n=0;n<this.out_depth;++n){for(var r=0,s=this.filters[n].w,p=0;p<this.num_inputs;++p)r+=o[p]*s[p];r+=this.biases.w[n],i.w[n]=r}return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var t=this.in_act,e=0;e<this.out_depth;++e){for(var a=this.filters[e],i=this.out_act.dw[e],o=0;o<this.num_inputs;++o)t.dw[o]+=a.w[o]*i,a.dw[o]+=t.w[o]*i;this.biases.dw[e]+=i}},i.prototype.getParamsAndGrads=function(){for(var t=[],e=0;e<this.out_depth;++e)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth},i.prototype.getNumParameters=function(){return[this.in_depth*this.in_sx*this.in_sy*this.out_depth,this.out_depth]},i.prototype.getOutputShape=function(){return[this.out_depth,1,1]},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.num_inputs=e.num_inputs,this.l1_decay_mul=void 0!==e.l1_decay_mul?e.l1_decay_mul:1,this.l2_decay_mul=void 0!==e.l2_decay_mul?e.l2_decay_mul:1,this.filters=[];for(var i=0;i<e.filters.length;i++)this.filters.push(t.Vol.fromJSON(e.filters[i]));this.biases=t.Vol.fromJSON(e.biases)},i}(t.BaseLayer);t.FullyConnectedLayer=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="dropout",this.drop_prob=t.getopt(e,["drop_prob"],.5),this.updateDimensions(e.pred)}return __extends(i,a),i.prototype.forward=function(t,a){void 0===a&&(a=!1),this.in_act=t,this.resetGradient(),this.dropped=e.zeros(this.out_sx*this.out_sy*this.out_depth,Int8Array);var i=t.clone(),o=t.w.length;if(a)for(var n=0;n<o;n++)Math.random()<this.drop_prob?(i.w[n]=0,this.dropped[n]=1):i.w[n]*=this.drop_prob;return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++)1!==this.dropped[i]&&(t.dw[i]+=e.dw[i])},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.drop_prob=this.drop_prob,t},i.prototype.fromJSON=function(t){a.prototype.fromJSON.call(this,t),this.drop_prob=t.drop_prob},i}(t.BaseLayer);t.DropoutLayer=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(t){function a(e){t.call(this,e||{}),this.layer_type="tanh",this.updateDimensions(e.pred)}return __extends(a,t),a.prototype.forward=function(t,a){this.in_act=t,this.resetGradient();for(var i=t.cloneAndZero(),o=t.w.length,n=0;n<o;n++)i.w[n]=e.tanh(t.w[n]);return this.out_act=i,this.out_act},a.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++){var o=e.w[i];t.dw[i]+=(1-o*o)*e.dw[i]}},a}(t.BaseLayer);t.TanhLayer=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(t){a.call(this,t||{}),this.layer_type="maxout",this.group_size=void 0!==t.group_size?t.group_size:2,this.updateDimensions(t.pred)}return __extends(i,a),i.prototype.forward=function(a,i){this.in_act=a,this.resetGradient(),this.switches=e.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array);var o=this.out_depth,n=new t.Vol(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var r=0;r<o;r++){for(var s=r*this.group_size,p=a.w[s],l=0,u=1;u<this.group_size;u++){var d=a.w[s+u];d>p&&(p=d,l=u)}n.w[r]=p,this.switches[r]=s+l}else for(var h=0,m=0;m<a.sx;m++)for(var f=0;f<a.sy;f++)for(var r=0;r<o;r++){for(var s=r*this.group_size,p=a.get(m,f,s),l=0,u=1;u<this.group_size;u++){var d=a.get(m,f,s+u);d>p&&(p=d,l=u)}n.set(m,f,r,p),this.switches[h]=s+l,h++}return this.out_act=n,this.out_act},i.prototype.backward=function(){var t=this.in_act,e=this.out_act,a=this.out_depth;if(1===this.out_sx&&1===this.out_sy)for(var i=0;i<a;i++){var o=e.dw[i];t.dw[this.switches[i]]+=o}else for(var n=0,r=0;r<e.sx;r++)for(var s=0;s<e.sy;s++)for(var i=0;i<a;i++){var o=e.get_grad(r,s,i);t.add_grad(r,s,this.switches[n],o),n++}},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=Math.floor(this.in_depth/this.group_size)},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.group_size=this.group_size,t},i.prototype.fromJSON=function(t){a.prototype.fromJSON.call(this,t),this.group_size=t.group_size},i}(t.BaseLayer);t.MaxoutLayer=a}(Net||(Net={}));var Net;!function(t){var e=function(t){function e(e){t.call(this,e||{}),this.layer_type="relu",this.updateDimensions(e.pred)}return __extends(e,t),e.prototype.forward=function(t,e){this.in_act=t,this.resetGradient();for(var a=t.clone(),i=t.w.length,o=a.w,n=0;n<i;n++)o[n]<0&&(o[n]=0);return this.out_act=a,this.out_act},e.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++)e.w[i]<=0?t.dw[i]=0:t.dw[i]+=e.dw[i]},e}(t.BaseLayer);t.ReluLayer=e}(Net||(Net={}));var Net;!function(t){var e=function(t){function e(e){t.call(this,e||{}),this.layer_type="sigmoid",this.updateDimensions(e.pred)}return __extends(e,t),e.prototype.forward=function(t,e){this.in_act=t,this.resetGradient();for(var a=t.cloneAndZero(),i=t.w.length,o=a.w,n=t.w,r=0;r<i;r++)o[r]=1/(1+Math.exp(-n[r]));return this.out_act=a,this.out_act},e.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++){var o=e.w[i];t.dw[i]+=o*(1-o)*e.dw[i]}},e}(t.BaseLayer);t.SigmoidLayer=e}(Net||(Net={}));var Net;!function(t){var e=function(t){function e(e){t.call(this,e||{}),this.layer_type="regression",this.updateDimensions(e.pred)}return __extends(e,t),e.prototype.forward=function(t,e){return this.in_act=t,this.resetGradient(),this.out_act=t,t},e.prototype.backward=function(t){var e=this.in_act,a=0;if(t instanceof Float32Array)for(var i=0;i<this.out_depth;i++){var o=e.w[i]-t[i];e.dw[i]=o,a+=.5*o*o}else if("number"==typeof t){var o=e.w[0]-t;e.dw[0]=o,a+=.5*o*o}else{var i=t.dim,n=t.val,o=e.w[i]-n;e.dw[i]=o,a+=.5*o*o}return a},e.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},e.prototype.getOutputShape=function(){return[this.out_depth,1,1]},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.num_inputs=this.num_inputs,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.num_inputs=e.num_inputs},e}(t.BaseLayer);t.RegressionLayer=e}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(a){function i(t){a.call(this,t||{}),this.layer_type="softmax",this.updateDimensions(t.pred)}return __extends(i,a),i.prototype.forward=function(a,i){this.in_act=a,this.resetGradient();for(var o=new t.Vol(1,1,this.out_depth,0),n=a.w,r=a.w[0],s=1;s<this.out_depth;s++)n[s]>r&&(r=n[s]);for(var p=e.zeros(this.out_depth),l=0,s=0;s<this.out_depth;s++){var u=Math.exp(n[s]-r);l+=u,p[s]=u}for(var s=0;s<this.out_depth;s++)p[s]/=l,o.w[s]=p[s];return this.es=p,this.out_act=o,this.out_act},i.prototype.backward=function(t){for(var e=this.in_act,a=0;a<this.out_depth;a++){var i=a===t?1:0,o=-(i-this.es[a]);e.dw[a]+=o}return-Math.log(this.es[t])},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},i.prototype.getOutputShape=function(){return[this.out_depth,1,1]},i.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.num_inputs=this.num_inputs,t},i.prototype.fromJSON=function(t){a.prototype.fromJSON.call(this,t),this.num_inputs=t.num_inputs},i}(t.BaseLayer);t.SoftmaxLayer=a}(Net||(Net={}));var Net;!function(t){var e=function(t){function e(e){t.call(this,e||{}),this.layer_type="svm",this.updateDimensions(e.pred)}return __extends(e,t),e.prototype.forward=function(t,e){return this.in_act=t,this.resetGradient(),this.out_act=t,t},e.prototype.backward=function(t){for(var e=this.in_act,a=e.w[t],i=1,o=0,n=0;n<this.out_depth;n++)if(t!==n){var r=-a+e.w[n]+i;r>0&&(e.dw[n]+=1,e.dw[t]-=1,o+=r)}return o},e.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},e.prototype.getOutputShape=function(){return[this.out_depth,1,1]},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.num_inputs=this.num_inputs,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.num_inputs=e.num_inputs},e}(t.BaseLayer);t.SVMLayer=e}(Net||(Net={}));var Net;!function(t){var e=function(t){function e(e){t.call(this,e||{}),this.layer_type="lrn",this.k=e.k,this.n=e.n,this.alpha=e.alpha,this.beta=e.beta,this.n%2===0&&console.warn("WARNING n should be odd for LRN layer"),this.updateDimensions(e.pred)}return __extends(e,t),e.prototype.forward=function(t,e){this.in_act=t,this.resetGradient();var a=t.cloneAndZero();this.S_cache_=t.cloneAndZero();for(var i=Math.floor(this.n/2),o=0;o<t.sx;o++)for(var n=0;n<t.sy;n++)for(var r=0;r<t.depth;r++){for(var s=t.get(o,n,r),p=this.k,l=this.alpha/this.n,u=0,d=Math.max(0,r-i);d<=Math.min(r+i,t.depth-1);d++){var h=t.get(o,n,d);u+=h*h}
var m=p+l*u;this.S_cache_.set(o,n,r,m);var f=s*Math.pow(m,-this.beta);a.set(o,n,r,f)}return this.out_act=a,this.out_act},e.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=Math.floor(this.n/2),i=0;i<t.sx;i++)for(var o=0;o<t.sy;o++)for(var n=0;n<t.depth;n++){for(var r=this.S_cache_.get(i,o,n),s=t.get(i,o,n),p=e.get_grad(i,o,n),l=Math.pow(r,-this.beta)*p,u=2*this.alpha*this.beta/this.n*s,d=0,h=Math.max(0,n-a);h<=Math.min(n+a,t.depth-1);h++){var m=e.get(i,o,h),f=e.get_grad(i,o,h),y=this.S_cache_.get(i,o,h);d+=f*m/y}var _=l-u*d;t.add_grad(i,o,n,_)}},e.prototype.getDescription=function(){return t.prototype.getDescription.call(this).concat(["n "+this.n+", k "+this.k])},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.k=this.k,e.n=this.n,e.alpha=this.alpha,e.beta=this.beta,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.k=e.k,this.n=e.n,this.alpha=e.alpha,this.beta=e.beta},e}(t.BaseLayer);t.LocalResponseNormalizationLayer=e}(Net||(Net={}));var Net;!function(t){var e=function(e){function a(t,a){e.call(this),this.modelPath=t,this.weightPath=a}return __extends(a,e),a.prototype.load=function(){var t=this;return this.fetch(this.modelPath).then(function(e){return t.create(e)}).then(function(e){return t.loadWeights()})},a.prototype.fetch=function(t){var e=new Parser.PrototxtParser;return e.parse(t)},a.prototype.create=function(t){this.name=t.name,this.createLayers(t,t.layer||t.layers,"data"===t.input),this.createEdges()},a.prototype.caffeLayerToJs=function(e){var a,i=this,o={name:e.name,input:e.bottom,output:e.top};switch(void 0!==e.bottom&&(Array.isArray(e.bottom)?o.pred=e.bottom.map(function(t){return i.layers.get(t)}):o.pred=[this.layers.get(e.bottom)]),e.type.toLowerCase()){case"input":var n=e.input_param||{};o.out_depth=+n.shape.dim[1],o.out_sx=+n.shape.dim[2],o.out_sy=+n.shape.dim[3],a=new t.InputLayer(o);break;case"conv":case"convolution":var n=e.param||{},r=e.convolution_param||{};o.sx=void 0!==r.kernel_size?+r.kernel_size:void 0,o.filters=void 0!==r.num_output?+r.num_output:void 0,o.pad=void 0!==r.pad?+r.pad:void 0,o.stride=void 0!==r.stride?+r.stride:void 0,o.l1_decay_mul=n&&n.length&&void 0!==n[0].decay_mult?+n[0].decay_mult:0,o.l2_decay_mul=n&&n.length&&void 0!==n[1].decay_mult?+n[1].decay_mult:1,a=new t.ConvLayer(o);break;case"lrn":var n=e.lrn_param||{};o.k=void 0!==n.k?+n.k:1,o.n=void 0!==n.local_size?+n.local_size:void 0,o.alpha=void 0!==n.alpha?+n.alpha:void 0,o.beta=void 0!==n.beta?+n.beta:void 0,a=new t.LocalResponseNormalizationLayer(o);break;case"dropout":var s=e.dropout_param||{};o.drop_prob=void 0!==s.dropout_ratio?+s.dropout_ratio:void 0,a=new t.DropoutLayer(o);break;case"concat":var r=e.concat_param||{};o.axis=void 0!==r.axis?+r.axis:void 0,a=new t.ConcatLayer(o);break;case"pool":case"pooling":var p=e.pooling_param||{};o.pool=void 0!==p.pool?p.pool:void 0,o.sx=void 0!==p.kernel_size?+p.kernel_size:void 0,o.pad=void 0!==p.pad?+p.pad:void 0,o.stride=void 0!==p.stride?+p.stride:void 0,a=new t.PoolLayer(o);break;case"inner_product":case"innerproduct":var p=e.inner_product_param||{},n=e.param||{};o.num_neurons=void 0!==p.num_output?+p.num_output:void 0,o.l1_decay_mul=n&&n.length&&void 0!==n[0].decay_mult?+n[0].decay_mult:0,o.l2_decay_mul=n&&n.length&&void 0!==n[1].decay_mult?+n[1].decay_mult:1,a=new t.FullyConnectedLayer(o);break;case"softmax":a=new t.SoftmaxLayer(o);break;case"relu":a=new t.ReluLayer(o);break;case"sigmoid":a=new t.SigmoidLayer(o);break;case"tanh":a=new t.TanhLayer(o);break;default:return void console.error("Cannot parse layer "+e.type,e)}this.layers.set(a.name,a)},a.prototype.createLayers=function(e,a,i){var o=this;void 0===i&&(i=!1),this.layers=d3.map(),i&&this.layers.set("data",new t.InputLayer({name:"data",in_depth:+e.input_dim[1],in_sy:+e.input_dim[2],in_sx:+e.input_dim[3]})),a.forEach(function(t){return o.caffeLayerToJs(t)})},a.prototype.createEdges=function(){var t=this;this.edges=[],this.layers.values().filter(function(t){return void 0!==t.input&&t.input!==t.output}).forEach(function(e){Array.isArray(e.input)?e.input.forEach(function(a){t.edges.push({from:a,to:e.output})}):t.edges.push({from:e.input,to:e.output})}),this.layers.values().filter(function(t){return void 0!==t.input&&t.input===t.output}).forEach(function(e){t.edges.filter(function(t){return t.from===e.input}).forEach(function(a){a.from=e.name,t.edges.push({from:e.input,to:e.name})})})},a.prototype.loadWeights=function(){var t=this;return this.weightPath?Promise.all(this.layers.values().filter(function(t){return"conv"==t.layer_type||"fc"==t.layer_type}).map(function(e){return Promise.all([fetch(t.weightPath+e.name+"_filter.bin").then(function(t){return t.arrayBuffer()}).then(function(t){for(var a=new Float32Array(t),i=e.sx*e.sy*e.in_depth,o=0;o<e.out_depth;o++)e.filters[o].w.set(a.slice(o*i,o*i+i))}),fetch(t.weightPath+e.name+"_bias.bin").then(function(t){return t.arrayBuffer()}).then(function(t){var a=new Float32Array(t);e.biases.w.set(a)})])})):Promise.resolve()},a}(t.Net);t.CaffeModel=e}(Net||(Net={}));var ImgJS;!function(t){var e=NumJS,a=function(){function t(t){this.src=t,this.canvas=document.createElement("canvas"),this.image=document.createElement("img")}return t.prototype.set=function(t){return this.data=t.data,this.image.width=t.width,this.image.height=t.height,this},t.prototype.load=function(){var t=this;return new Promise(function(e,a){var i=t.canvas.getContext("2d");t.image.onload=function(){i.imageSmoothingEnabled=!1,t.canvas.width=t.image.width,t.canvas.height=t.image.height,i.drawImage(t.image,0,0);var a=i.getImageData(0,0,t.image.width,t.image.height);t.data=a.data,e(t.data)},t.image.src=t.src})},t.prototype.render=function(t){void 0===t&&(t=this.canvas,document.body.appendChild(t)),t.width=this.image.width,t.height=this.image.height;var e=t.getContext("2d");e.imageSmoothingEnabled=!1;var a=e.getImageData(0,0,this.image.width,this.image.height);a.data.set(this.data),e.putImageData(a,0,0)},t.fromMean=function(e,a,i,o){return void 0===a&&(a=0),void 0===i&&(i=1),void 0===o&&(o=!1),t.fromVol(e,0,[0,1,2],i,o)},t.fromFilter=function(e,a,i,o){return void 0===a&&(a=0),void 0===i&&(i=1),void 0===o&&(o=!0),t.fromVol(e,0,a,i,o)},t.fromVol=function(a,i,o,n,r,s){void 0===o&&(o=[2,1,0]),void 0===n&&(n=1),void 0===r&&(r=!1),void 0===s&&(s=255);var p=new t;i=void 0!==i?i:[0,0,0];for(var l=a.sx,u=a.sy,d=l*u*4,h=e.maxmin(a.w),m=o?o instanceof Array?o[0]:+o:0,f=o?o instanceof Array?o[1]:+o:0,y=o?o instanceof Array?o[2]:+o:0,_=new Uint8ClampedArray(d),c=0;c<u;c++)for(var v=0;v<l;v++){var g=4*(c*l+v),w=i?i instanceof Net.Vol?i.get(v,c,m):+i[m]:0,P=i?i instanceof Net.Vol?i.get(v,c,f):+i[f]:0,N=i?i instanceof Net.Vol?i.get(v,c,y):+i[y]:0,x=a.get(v,c,m),b=a.get(v,c,f),S=a.get(v,c,y);r&&(x=Math.floor((a.get(v,c,m)-h.minv)/h.dv*255),b=Math.floor((a.get(v,c,f)-h.minv)/h.dv*255),S=Math.floor((a.get(v,c,y)-h.minv)/h.dv*255)),_[g+0]=x+w,_[g+1]=b+P,_[g+2]=S+N,_[g+3]=s}return p.image.width=l,p.image.height=u,p.data=_,p},t.prototype.toVol=function(t,e){void 0===e&&(e=[2,1,0]),t=void 0!==t?t:[0,0,0];for(var a=this.image.width,i=this.image.height,o=e[0],n=e[1],r=e[2],s=new Net.Vol(a,i,3,0),p=0;p<i;p++)for(var l=0;l<a;l++){var u=4*(p*a+l),d=t instanceof Net.Vol?t.get(l,p,o):+t[o],h=t instanceof Net.Vol?t.get(l,p,n):+t[n],m=t instanceof Net.Vol?t.get(l,p,r):+t[r];s.set(l,p,o,this.data[u+0]-d),s.set(l,p,n,this.data[u+1]-h),s.set(l,p,r,this.data[u+2]-m)}return s},t}();t.Image=a}(ImgJS||(ImgJS={}));var Utils;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.render=function(t,e,a){var i=new dagreD3.render;this.graph=this.createGraph(),this.$elem=d3.select(t),this.$elem.selectAll("*").remove(),this.$svg=this.$elem.append("svg"),this.$g=this.$svg.append("g"),i(this.$g,this.graph),this.width=e||this.graph.graph().width,this.height=a||this.graph.graph().height;var o=(this.width-this.graph.graph().width)/2;return this.$g.attr("transform","translate("+o+")"),this.$svg.attr("width",this.width),this.$svg.attr("height",this.height),this},e.prototype.fit=function(){return this.$svg.attr("viewBox","0 0 "+this.graph.graph().width+" "+this.graph.graph().height),this},e.prototype.rotate=function(){var t=(this.width-this.graph.graph().width)/2;return this.$g.attr("transform","rotate(270) translate("+t+")"),this.$svg.attr("viewBox","0 0 "+this.graph.graph().height+" "+this.graph.graph().width),this},e.prototype.createGraph=function(){var t=this,e=(new dagreD3.graphlib.Graph).setGraph({}).setDefaultEdgeLabel(function(){return{}});return this.layerIterator(function(t,a,i){e.setNode(t.name,{labelType:"html",label:t.getDescription().join("<br>"),"class":"layer-"+t.layer_type})}),e.nodes().forEach(function(t){var a=e.node(t);a.rx=a.ry=5}),this.edges.filter(function(t){return void 0!==t.from&&void 0!==t.to}).forEach(function(a){e.setEdge(a.from,a.to,{label:t.layers.get(a.from).getOutputShape().join("x")})}),e},e.fromNet=function(t){var a=new e;return a.layers=t.layers,a.edges=t.edges,a},e}(Net.Net);t.GraphDrawer=e}(Utils||(Utils={}));var Utils;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.render=function(t,e,a,i,o){void 0===e&&(e=!0);var n=d3.select(t);n.selectAll("*").remove(),this.layerIterator(function(t,i){if(e||0!=i){n.append("h5").text(t.name);for(var o=n.append("div").attr("class","net-layer"),r=o.append("div").attr("class","net-vis"),s=(r.append("div").attr("class","net-weights"),r.append("div").attr("class","net-activations")),p=0,l=t.out_act.depth;p<l;++p){if(a&&p>=a)return;var u=s.append("canvas"),d=t.out_act;ImgJS.Image.fromFilter(d,p,1).render(u[0][0])}}})},e.fromNet=function(t){var a=new e;return a.layers=t.layers,a.edges=t.edges,a},e}(Net.Net);t.ActivationDrawer=e}(Utils||(Utils={}));