!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).prototxtParser=n()}}(function(){var n={exports:{}};!function(t,r){"object"==typeof n.exports?n.exports=r():"object"==typeof n.exports?n.exports.Parsimmon=r():t.Parsimmon=r()}(this,function(){return function(n){function t(e){if(r[e])return r[e].exports;var u=r[e]={i:e,l:!1,exports:{}};return n[e].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=n,t.c=r,t.i=function(n){return n},t.d=function(n,r,e){t.o(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:e})},t.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(r,"a",r),r},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=0)}([function(n,t,r){"use strict";function e(n){if(!(this instanceof e))return new e(n);this._=n}function u(n){return n instanceof e}function i(n){return"[object Array]"==={}.toString.call(n)}function o(n,t){return{status:!0,index:n,value:t,furthest:-1,expected:[]}}function a(n,t){return{status:!1,index:-1,value:null,furthest:n,expected:[t]}}function f(n,t){if(!t)return n;if(n.furthest>t.furthest)return n;var r=n.furthest===t.furthest?function(n,t){var r=n.length,e=t.length;if(0===r)return t;if(0===e)return n;for(var u={},i=0;i<r;i++)u[n[i]]=!0;for(var o=0;o<e;o++)u[t[o]]=!0;var a=[];for(var f in u)u.hasOwnProperty(f)&&a.push(f);return a.sort(),a}(n.expected,t.expected):t.expected;return{status:n.status,index:n.index,value:n.value,furthest:t.furthest,expected:r}}function c(n,t){var r=n.slice(0,t).split("\n");return{offset:t,line:r.length,column:r[r.length-1].length+1}}function s(n){if(!u(n))throw new Error("not a parser: "+n)}function l(n){if("number"!=typeof n)throw new Error("not a number: "+n)}function p(n){if("function"!=typeof n)throw new Error("not a function: "+n)}function h(n){if("string"!=typeof n)throw new Error("not a string: "+n)}function d(n,t){return"expected "+function(n){return 1===n.length?n[0]:"one of "+n.join(", ")}(t.expected)+function(n,r){var e=t.index,u=e.offset;if(u===n.length)return", got the end of the input";var i=u>0?"'...":"'",o=n.length-u>12?"...'":"'";return" at line "+e.line+" column "+e.column+", got "+i+n.slice(u,u+12)+o}(n)}function v(n){var t=""+n;return t.slice(t.lastIndexOf("/")+1)}function g(){for(var n=[].slice.call(arguments),t=n.length,r=0;r<t;r+=1)s(n[r]);return e(function(r,e){for(var u,i=new Array(t),a=0;a<t;a+=1){if(!(u=f(n[a]._(r,e),u)).status)return u;i[a]=u.value,e=u.index}return f(o(e,i),u)})}function m(){var n=[].slice.call(arguments);if(0===n.length)throw new Error("seqMap needs at least one argument");var t=n.pop();return p(t),g.apply(null,n).map(function(n){return t.apply(null,n)})}function x(){var n=[].slice.call(arguments),t=n.length;if(0===t)return O("zero alternates");for(var r=0;r<t;r+=1)s(n[r]);return e(function(t,r){for(var e,u=0;u<n.length;u+=1)if((e=f(n[u]._(t,r),e)).status)return e;return e})}function y(n,t){return w(n,t).or(E([]))}function w(n,t){s(n),s(t);var r=t.then(n).many();return n.chain(function(n){return r.map(function(t){return[n].concat(t)})})}function b(n){h(n);var t="'"+n+"'";return e(function(r,e){var u=e+n.length,i=r.slice(e,u);return i===n?o(u,i):a(e,t)})}function _(n,t){(function(n){if(!(n instanceof RegExp))throw new Error("not a regexp: "+n);for(var t=v(n),r=0;r<t.length;r++){var e=t.charAt(r);if("i"!==e&&"m"!==e&&"u"!==e)throw new Error('unsupported regexp flag "'+e+'": '+n)}})(n),arguments.length>=2?l(t):t=0;var r=function(n){return RegExp("^(?:"+n.source+")",v(n))}(n),u=""+n;return e(function(n,e){var i=r.exec(n.slice(e));if(i){if(0<=t&&t<=i.length){var f=i[0],c=i[t];return o(e+f.length,c)}return a(e,"valid match group (0 to "+i.length+") in "+u)}return a(e,u)})}function E(n){return e(function(t,r){return o(r,n)})}function O(n){return e(function(t,r){return a(r,n)})}function P(n){if(u(n))return e(function(t,r){var e=n._(t,r);return e.index=r,e.value="",e});if("string"==typeof n)return P(b(n));if(n instanceof RegExp)return P(_(n));throw new Error("not a string, regexp, or parser: "+n)}function k(n){return s(n),e(function(t,r){var e=n._(t,r),u=t.slice(r,e.index);return e.status?a(r,'not "'+u+'"'):o(r,null)})}function j(n){return p(n),e(function(t,r){var e=t.charAt(r);return r<t.length&&n(e)?o(r+1,e):a(r,"a character matching "+n)})}function A(n,t){arguments.length<2&&(t=n,n=void 0);var r=e(function(n,e){return r._=t()._,r._(n,e)});return n?r.desc(n):r}function q(){return O("fantasy-land/empty")}var z=e.prototype;z.parse=function(n){if("string"!=typeof n)throw new Error(".parse must be called with a string as its argument");var t=this.skip(F)._(n,0);return t.status?{status:!0,value:t.value}:{status:!1,index:c(n,t.furthest),expected:t.expected}},z.tryParse=function(n){var t=this.parse(n);if(t.status)return t.value;var r=d(n,t),e=new Error(r);throw e.type="ParsimmonError",e.result=t,e},z.or=function(n){return x(this,n)},z.trim=function(n){return this.wrap(n,n)},z.wrap=function(n,t){return m(n,this,t,function(n,t){return t})},z.thru=function(n){return n(this)},z.then=function(n){return s(n),g(this,n).map(function(n){return n[1]})},z.many=function(){var n=this;return e(function(t,r){for(var e=[],u=void 0;;){if(!(u=f(n._(t,r),u)).status)return f(o(r,e),u);r=u.index,e.push(u.value)}})},z.tie=function(){return this.map(function(n){!function(n){if(!i(n))throw new Error("not an array: "+n)}(n);for(var t="",r=0;r<n.length;r++)h(n[r]),t+=n[r];return t})},z.times=function(n,t){var r=this;return arguments.length<2&&(t=n),l(n),l(t),e(function(e,u){for(var i=[],a=void 0,c=void 0,s=0;s<n;s+=1){if(a=r._(e,u),c=f(a,c),!a.status)return c;u=a.index,i.push(a.value)}for(;s<t&&(a=r._(e,u),c=f(a,c),a.status);s+=1)u=a.index,i.push(a.value);return f(o(u,i),c)})},z.result=function(n){return this.map(function(){return n})},z.atMost=function(n){return this.times(0,n)},z.atLeast=function(n){return m(this.times(n),this.many(),function(n,t){return n.concat(t)})},z.map=function(n){p(n);var t=this;return e(function(r,e){var u=t._(r,e);return u.status?f(o(u.index,n(u.value)),u):u})},z.skip=function(n){return g(this,n).map(function(n){return n[0]})},z.mark=function(){return m(S,this,S,function(n,t,r){return{start:n,value:t,end:r}})},z.node=function(n){return m(S,this,S,function(t,r,e){return{name:n,value:r,start:t,end:e}})},z.sepBy=function(n){return y(this,n)},z.sepBy1=function(n){return w(this,n)},z.lookahead=function(n){return this.skip(P(n))},z.notFollowedBy=function(n){return this.skip(k(n))},z.desc=function(n){var t=this;return e(function(r,e){var u=t._(r,e);return u.status||(u.expected=[n]),u})},z.fallback=function(n){return this.or(E(n))},z.ap=function(n){return m(n,this,function(n,t){return n(t)})},z.chain=function(n){var t=this;return e(function(r,e){var u=t._(r,e);return u.status?f(n(u.value)._(r,u.index),u):u})},z.concat=z.or,z.empty=q,z.of=E,z["fantasy-land/ap"]=z.ap,z["fantasy-land/chain"]=z.chain,z["fantasy-land/concat"]=z.concat,z["fantasy-land/empty"]=z.empty,z["fantasy-land/of"]=z.of,z["fantasy-land/map"]=z.map;var S=e(function(n,t){return o(t,c(n,t))}),B=e(function(n,t){return t>=n.length?a(t,"any character"):o(t+1,n.charAt(t))}),M=e(function(n,t){return o(n.length,n.slice(t))}),F=e(function(n,t){return t<n.length?a(t,"EOF"):o(t,null)}),Q=_(/[0-9]/).desc("a digit"),L=_(/[0-9]*/).desc("optional digits"),R=_(/[a-z]/i).desc("a letter"),W=_(/[a-z]*/i).desc("optional letters"),C=_(/\s*/).desc("optional whitespace"),I=_(/\s+/).desc("whitespace");e.all=M,e.alt=x,e.any=B,e.createLanguage=function(n){var t={};for(var r in n)({}).hasOwnProperty.call(n,r)&&function(r){t[r]=A(function(){return n[r](t)})}(r);return t},e.custom=function(n){return e(n(o,a))},e.digit=Q,e.digits=L,e.empty=q,e.eof=F,e.fail=O,e.formatError=d,e.index=S,e.isParser=u,e.lazy=A,e.letter=R,e.letters=W,e.lookahead=P,e.makeFailure=a,e.makeSuccess=o,e.noneOf=function(n){return j(function(t){return n.indexOf(t)<0})},e.notFollowedBy=k,e.of=E,e.oneOf=function(n){return j(function(t){return n.indexOf(t)>=0})},e.optWhitespace=C,e.Parser=e,e.range=function(n,t){return j(function(r){return n<=r&&r<=t}).desc(n+"-"+t)},e.regex=_,e.regexp=_,e.sepBy=y,e.sepBy1=w,e.seq=g,e.seqMap=m,e.seqObj=function(){for(var n={},t=0,r=[].slice.call(arguments),a=r.length,c=0;c<a;c+=1){var s=r[c];if(!u(s)){if(i(s)&&2===s.length&&"string"==typeof s[0]&&u(s[1])){var l=s[0];if(n[l])throw new Error("seqObj: duplicate key "+l);n[l]=!0,t++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===t)throw new Error("seqObj expects at least one named parser, found zero");return e(function(n,t){for(var e,u={},c=0;c<a;c+=1){var s,l;if(i(r[c])?(s=r[c][0],l=r[c][1]):(s=null,l=r[c]),!(e=f(l._(n,t),e)).status)return e;s&&(u[s]=e.value),t=e.index}return f(o(t,u),e)})},e.string=b,e.succeed=E,e.takeWhile=function(n){return p(n),e(function(t,r){for(var e=r;e<t.length&&n(t.charAt(e));)e++;return o(e,t.slice(r,e))})},e.test=j,e.whitespace=I,e["fantasy-land/empty"]=q,e["fantasy-land/of"]=E,n.exports=e}])}),n=n.exports;var t={};Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){return n.filter(function(n){return Array.isArray(n)})},e=function(n){return n.reduce(function(n,t){var r=t[0],e=t[1];return n[r]=n.hasOwnProperty(r)?[].concat(n[r],e):e,n},{})},u=function(n){var t={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};return n.replace(/\\(u[0-9a-fA-F]{4}|[^u])/,function(n,r){var e=r.charAt(0),u=r.slice(1);return"u"===e?String.fromCharCode(parseInt(u,16)):t.hasOwnProperty(e)?t[e]:e})},i=n.regexp(/\s*/m),o=function(n){return n.skip(i)},a=function(t){return n.string(t).thru(o)},f=n.createLanguage({value:function(t){return n.alt(t.number,t.null,t.true,t.false,t.string,t.identifier).thru(function(n){return i.then(n)}).desc("value")},identifier:function(){return o(n.regexp(/[a-zA-Z_-][a-zA-Z0-9_+-]*/).desc("identifier"))},lbrace:function(){return a("{")},rbrace:function(){return a("}")},colon:function(){return a(":")},null:function(){return a("null").result(null)},true:function(){return a("true").result(!0)},false:function(){return a("false").result(!1)},comment:function(){return n.regexp(/\s*#\s*(.*)/m,1)},doubleQuotedString:function(){return n.regexp(/"((?:\\.|.)*?)"/,1)},singleQuotedString:function(){return n.regexp(/'((?:\\.|.)*?)'/,1)},string:function(t){return o(n.alt(t.doubleQuotedString,t.singleQuotedString)).map(u).desc("string")},number:function(){return o(n.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/)).map(Number).desc("number")},pair:function(t){return n.seq(t.identifier.skip(t.colon),t.value)},message:function(t){return n.seq(t.identifier,t.colon.times(0,1).then(t.lbrace).then(t.exp).skip(t.rbrace))},exp:function(t){return n.alt(t.pair,t.message,t.comment).trim(n.optWhitespace).many().map(r).map(e)}});t.parse=function(n){return f.exp.tryParse(n)};var c={};return Object.defineProperty(c,"__esModule",{value:!0}),c.parse=t.parse,c});

var NumJS;!function(t){t.DEFAULT_TYPE_INSTANCE=Float32Array,t.zeros=function(e,a){return void 0===a&&(a=t.DEFAULT_TYPE_INSTANCE),new a(e)},t.fill=function(t,e){for(var a=0,i=t.length;a<i;++a)t[a]=e;return t},t.prod=function(t){for(var e=1,a=0,i=t.length;a<i;++a)e*=t[a];return e},t.sum=function(t){for(var e=0,a=0,i=t.length;a<i;++a)e+=t[a];return e},t.add=function(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]+=e[a];return t}throw new TypeError("Bad input shapes "+t.length+" "+e.length)},t.addConst=function(t,e){for(var a=0,i=t.length;a<i;++a)t[a]+=e;return t},t.sub=function(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]-=e[a];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)},t.subConst=function(t,e){for(var a=0,i=t.length;a<i;++a)t[a]-=e;return t},t.mul=function(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]*=e[a];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)},t.mulByConst=function(t,e){for(var a=0,i=t.length;a<i;++a)t[a]*=e;return t},t.div=function(t,e){if(t.length===e.length){for(var a=0,i=t.length;a<i;++a)t[a]/=e[a];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)},t.divByConst=function(t,e){for(var a=0,i=t.length;a<i;++a)t[a]/=e;return t},t.addScaled=function(t,e,a){if(t.length===e.length){for(var i=0,o=t.length;i<o;++i)t[i]+=a*e[i];return t}throw new TypeError("Bad input shape "+t.length+" "+e.length)}}(NumJS||(NumJS={}));var NumJS;!function(t){t.max=function(t){for(var e=Number.NEGATIVE_INFINITY,a=0,i=t.length;a<i;++a)t[a]>e&&(e=t[a]);return e},t.argmax=function(t){for(var e=Number.NEGATIVE_INFINITY,a=0,i=0,o=t.length;i<o;++i)t[i]>e&&(e=t[i],a=i);return a},t.maxn=function(t,e){return e=e||3,t.slice(0).sort(function(t,e){return e-t}).slice(0,e)},t.argmaxn=function(t,e){e=e||3;for(var a=t.length,i=new Uint32Array(a),o=0;o<a;++o)i[o]=o;return i.sort(function(e,a){return t[a]-t[e]}).slice(0,e)},t.maxmin=function(t){if(0===t.length)return{};for(var e=t[0],a=t[0],i=0,o=0,n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n],i=n),t[n]<a&&(a=t[n],o=n);return{maxi:i,maxv:e,mini:o,minv:a,dv:e-a}}}(NumJS||(NumJS={}));var NumJS;!function(t){function e(){if(a)return a=!1,i;var t=2*Math.random()-1,o=2*Math.random()-1,n=t*t+o*o;if(0==n||n>1)return e();var r=Math.sqrt(-2*Math.log(n)/n);return i=o*r,a=!0,t*r}var a=!1,i=0;t.gaussRandom=e,t.randf=function(t,e){return Math.random()*(e-t)+t},t.randi=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.randn=function(t,a){return t+e()*a},t.randperm=function(t){for(var e,a=t,i=0,o=[],n=0;n<t;++n)o[n]=n;for(;a--;)i=Math.floor(Math.random()*(a+1)),e=o[a],o[a]=o[i],o[i]=e;return o}}(NumJS||(NumJS={}));var NumJS;!function(t){t.clip=function(t,e,a){return Math.max(Math.min(t,a),e)},t.mod=function(t,e){return(t%e+e)%e},t.tanh=function(t){var e=Math.exp(2*t);return(e-1)/(e+1)}}(NumJS||(NumJS={}));var Net;!function(t){function e(t,e){for(var a=0,i=t.length;a<i;a++)if(t[a]===e)return!0;return!1}var a=NumJS;t.weightedSample=function(t,e){for(var i=a.randf(0,1),o=0,n=0,r=t.length;n<r;n++)if(o+=e[n],i<o)return t[n]},t.getopt=function(t,e,a){if(void 0===t&&(t={}),"string"==typeof e)return void 0!==t[e]?t[e]:a;var i=a;return e.forEach(function(e){i=void 0!==t[e]?t[e]:i}),i},t.assert=function(t,e){if(!t){if(e=e||"Assertion failed","undefined"!=typeof Error)throw new Error(e);throw e}},t.arrContains=e,t.arrUnique=function(t){for(var a=[],i=0,o=t.length;i<o;i++)e(a,t[i])||a.push(t[i]);return a}}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(){function t(){}return t.prototype.getLayer=function(t){return this.layers.get(t)},t.prototype.setInputDimensions=function(t,e,a){void 0===a&&(a=3),this.layerIterator(function(i,o,n){0===o?(i.in_sx=t,i.in_sy=e,i.in_depth=a,i.updateDimensions()):i.updateDimensions(n)})},t.prototype.layerIterator=function(t,e){var a=this;void 0===e&&(e={});var i,o=[],n=[],r=0,s=d3.set();void 0===e.reverse||!1===e.reverse?(i=e.start?this.layers.get(e.start):this.layers.get("data"),n=this.edges):(i=e.start?this.layers.get(e.start):this.layers.values()[this.layers.size()-1],n=this.edges.map(function(t){return{from:t.to,to:t.from}}));var p=d3.map(d3.nest().key(function(t){return t.from}).entries(n),function(t){return t.key}),l=d3.map(d3.nest().key(function(t){return t.to}).entries(n),function(t){return t.key});for(o.push(i);o.length;){var u=o.pop();s.add(u.name);var d=l.get(u.name);if(t(u,r++,void 0===d?void 0:d.values.map(function(t){return a.layers.get(t.from)})),e.end&&u.name===e.end)break;var m=p.get(u.name);m&&m.values.filter(function(t){return!s.has(t.to)}).forEach(function(t){var e=l.get(t.to);0===(void 0===e?[]:e.values.filter(function(t){return!s.has(t.from)})).length&&o.push(a.layers.get(t.to))})}},t.prototype.forward=function(t,e,a){void 0===e&&(e=!1),void 0===a&&(a={});var i,o=d3.map();return this.layerIterator(function(a,n,r){i=void 0===r?t:r.length>1?r.map(function(t){return o.get(t.name)}):o.get(r[0].name),i=a.forward(i,e),o.set(a.name,i)},a),i},t.prototype.backward=function(t,e){void 0===e&&(e={}),e.reverse=!0;var a;return this.layerIterator(function(e,i,o){void 0!==t&&0===i?a=e.backward(t):e.backward()},e),a},t.prototype.debugStructure=function(){var t=0,a=d3.format("s"),i=d3.format(",d"),o=0;this.layerIterator(function(a,n,r){var s=e.sum(a.getNumParameters()),p="";p+=a.getOutputShape().join("x")+" :: ",p+=a.getDescription().join(" "),s&&(t+=s,p+=" => "+i(s)+" parameters"),o+=1,console.log(p)}),console.log("---"),console.log("Total number of layers "+i(o)),console.log("Total number of params "+i(t)+" (memory: "+a(4*t)+"b): ")},t}();t.Model=a}(Net||(Net={}));var Net;!function(t){var e=NumJS,a=function(){function t(t,a,i,o){this.sx=t,this.sy=a,this.depth=i;var n=this.sx*this.sy*this.depth;if(this.w=e.zeros(n),void 0===o)for(var r=Math.sqrt(1/n),s=0;s<n;++s)this.w[s]=e.randn(0,r);else 0!==o&&e.fill(this.w,o)}return t.fromArray=function(e){var a=new t(1,1,e.length,0);return a.w.set(e),a},t.prototype.clone=function(){var e=new t(this.sx,this.sy,this.depth,0);return e.w.set(this.w),e},t.prototype.cloneAndZero=function(){return new t(this.sx,this.sy,this.depth,0)},t.prototype.get=function(t,e,a){var i=(this.sx*e+t)*this.depth+a;return this.w[i]},t.prototype.set=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.w[o]=i},t.prototype.add=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]+=i,this},t.prototype.sub=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]-=i,this},t.prototype.mul=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]*=i,this},t.prototype.div=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;return this.w[o]/=i,this},t.prototype.get_grad=function(t,e,a){var i=(this.sx*e+t)*this.depth+a;return this.dw[i]},t.prototype.set_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]=i},t.prototype.add_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]+=i},t.prototype.sub_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]-=i},t.prototype.mul_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]*=i},t.prototype.div_grad=function(t,e,a,i){var o=(this.sx*e+t)*this.depth+a;this.dw[o]/=i},t.prototype.roll=function(t,a,i){void 0===t&&(t=0),void 0===a&&(a=0),void 0===i&&(i=0);for(var o=this.clone(),n=0,r=o.depth;n<r;++n)for(var s=0,p=o.sx;s<p;++s)for(var l=0,u=o.sy;l<u;++l){var d=this.get(e.mod(s+t,this.sx),e.mod(l+a,this.sy),e.mod(n+i,this.depth));o.set(s,l,n,d)}return o},t.prototype.zoom=function(e,a,i){void 0===e&&(e=1),void 0===a&&(a=1),void 0===i&&(i=1);for(var o=new t(Math.round(this.sx*e),Math.round(this.sy*a),Math.round(this.depth*i),0),n=0,r=o.depth;n<r;++n)for(var s=0,p=o.sx;s<p;++s)for(var l=0,u=o.sy;l<u;++l){for(var d=0,m=Math.ceil(1/e),h=Math.ceil(1/a),f=Math.ceil(1/i),y=Math.ceil(s/e),_=Math.ceil(l/a),c=Math.ceil(n/i),v=Math.min(y+m,this.sx),g=Math.min(_+h,this.sy),w=Math.min(c+f,this.depth),P=y;P<v;P++)for(var N=_;N<g;N++)for(var x=c;x<w;x++){var S=this.get(P,N,x);o.add(s,l,n,S),d++}o.div(s,l,n,d)}return o},t.prototype.toJSON=function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},t.fromJSON=function(e){var a=new t(e.sx,e.sy,e.depth,0);return a.w.set(e.w),a},t}();t.Vol=a}(Net||(Net={}));var Net;!function(t){!function(t){var e=NumJS,a=function(){function t(t){this.in_depth=1,this.in_sy=1,this.in_sx=1,this.out_depth=1,this.out_sy=1,this.out_sx=1,this.name=void 0!==t.name?t.name:"",this.input=void 0!==t.input?t.input:void 0,this.output=void 0!==t.output?t.output:void 0,t.pred||(this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.in_depth=t.in_depth)}return t.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=this.in_depth},t.prototype.resetGradient=function(){if(this.in_act instanceof Array)for(var t=0;t<this.in_act.length;t++)this.in_act[t].dw=e.zeros(this.in_act[t].w.length);else this.in_act.dw=e.zeros(this.in_act.w.length)},t.prototype.getNumParameters=function(){return[0,0]},t.prototype.getOutputShape=function(){return this.in_sy&&this.in_sx?[this.in_depth,this.in_sy,this.in_sx]:[this.in_depth]},t.prototype.getDescription=function(){return[this.layer_type.toUpperCase(),this.name]},t.prototype.getParamsAndGrads=function(){return[]},t.prototype.toJSON=function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.name=this.name,t.output=this.output,t.input=this.input,t},t.prototype.fromJSON=function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.name=t.name,this.output=t.output,this.input=t.input},t}();t.BaseLayer=a}(t.Layers||(t.Layers={}))}(Net||(Net={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(a){var i=e.call(this,a||{})||this;return i.layer_type="concat",i.axis=t.getopt(a,["axis"],1),i.updateDimensions(a.pred),i}return __extends(i,e),i.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();var i=new t.Vol(this.out_sx,this.out_sy,this.out_depth,0),o=0;if(0===this.axis)for(var n=i.w,r=0;r<e.length;r++)n.set(e[r].w,o),o+=e[r].w.length;else for(var s=0;s<e.length;s++){for(var p=e[s],l=0;l<p.depth;l++)for(var u=0;u<p.sx;u++)for(var d=0;d<p.sy;d++)i.set(u,d,l+o,p.get(u,d,l));o+=p.depth}return this.out_act=i,this.out_act},i.prototype.backward=function(){var t=this.in_act,e=this.out_act,i=0;if(0===this.axis)for(var o=e.dw,n=0;n<t.length;n++){p=t[n].dw;i+=(p=a.add(p,o.slice(i,i+p.length))).length}else for(var n=0,r=t.length;n<r;++n){for(var s=t[n],p=t[n].dw,l=0,u=s.depth;l<u;++l)for(var d=0,m=s.sx;d<m;++d)for(var h=0,f=s.sy;h<f;++h)s.add_grad(d,h,l,e.get_grad(d,h,l+i));i+=s.depth}},i.prototype.updateDimensions=function(t){t&&(0==this.axis?(this.in_sx=t[0].in_sx,this.in_sy=t[0].in_sy,this.in_depth=t[0].in_depth):(this.in_sx=t[0].in_sx,this.in_sy=t[0].in_sy,this.in_depth=a.sum(t.map(function(t){return t.out_depth})))),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=this.in_depth},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.axis=this.axis,t},i.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.axis=t.axis},i}(e.BaseLayer);e.ConcatLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(a){var i=e.call(this,a||{})||this;i.layer_type="conv",i.out_depth=a.filters,i.sx=a.sx,i.sy=t.getopt(a,["sy"],i.sx),i.stride=t.getopt(a,["stride"],1),i.pad=t.getopt(a,["pad"],0),i.conv_groups=t.getopt(a,["group"],1),i.l1_decay_mul=t.getopt(a,["l1_decay_mul"],0),i.l2_decay_mul=t.getopt(a,["l2_decay_mul"],1),i.updateDimensions(a.pred);var o=t.getopt(a,["bias_pref"],0);i.biases=new t.Vol(1,1,i.out_depth,o),i.filters=[];for(var n=Math.ceil(i.in_depth/i.conv_groups),r=0;r<i.out_depth;++r)i.filters.push(new t.Vol(i.sx,i.sy,n,0));return i}return __extends(i,e),i.prototype.resetGradient=function(){e.prototype.resetGradient.call(this);for(var t=0;t<this.out_depth;++t)this.filters[t].dw=a.zeros(this.filters[t].w.length);this.biases.dw=a.zeros(this.out_depth)},i.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();for(var i=new t.Vol(0|this.out_sx,0|this.out_sy,0|this.out_depth,0),o=0|e.sx,n=0|e.sy,r=0|this.stride,s=Math.ceil(this.out_depth/this.conv_groups),p=0;p<this.conv_groups;++p)for(var l=p*s,u=l+s,d=l;d<u;++d)for(var m=this.filters[d],h=0|-this.pad,f=0|-this.pad,y=0;y<this.out_sy;f+=r,++y){h=0|-this.pad;for(var _=0;_<this.out_sx;h+=r,++_){for(var c=0,v=0;v<m.sy;++v)for(var g=f+v,w=0;w<m.sx;++w){var P=h+w;if(g>=0&&g<n&&P>=0&&P<o)for(var N=0;N<m.depth;++N)c+=m.w[(m.sx*v+w)*m.depth+N]*e.w[(o*g+P)*e.depth*(p+1)+N]}c+=this.biases.w[d],i.set(_,y,d,c)}}return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var t=this.in_act,e=0|t.sx,a=0|t.sy,i=0|this.stride,o=Math.ceil(this.out_depth/this.conv_groups),n=0;n<this.conv_groups;++n)for(var r=n*o,s=r+o,p=r;p<s;++p)for(var l=this.filters[p],u=0|-this.pad,d=0|-this.pad,m=0;m<this.out_sy;d+=i,++m){u=0|-this.pad;for(var h=0;h<this.out_sx;u+=i,++h){for(var f=this.out_act.get_grad(h,m,p),y=0;y<l.sy;++y)for(var _=d+y,c=0;c<l.sx;++c){var v=u+c;if(_>=0&&_<a&&v>=0&&v<e)for(var g=0;g<l.depth;++g){var w=(e*_+v)*t.depth*(n+1)+g,P=(l.sx*y+c)*l.depth+g;l.dw[P]+=t.w[w]*f,t.dw[w]+=l.w[P]*f}}this.biases.dw[p]+=f}}},i.prototype.getParamsAndGrads=function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth);var e=this.getOutputShape();this.out_sx=e[1],this.out_sy=e[2]},i.prototype.getNumParameters=function(){return[Math.ceil(this.in_depth*this.sx*this.sy*this.out_depth/this.conv_groups),this.out_depth]},i.prototype.getOutputShape=function(){return[this.out_depth,Math.round((this.in_sx+2*this.pad-this.sx)/this.stride+1),Math.round((this.in_sy+2*this.pad-this.sy)/this.stride+1)]},i.prototype.getDescription=function(){return e.prototype.getDescription.call(this).concat([[this.out_depth,this.sy,this.sx].join("x")+" stride="+this.stride+" pad="+this.pad])},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var a=0;a<this.filters.length;a++)t.filters.push(this.filters[a].toJSON());return t.biases=this.biases.toJSON(),t},i.prototype.fromJSON=function(a){e.prototype.fromJSON.call(this,a),this.sx=a.sx,this.sy=a.sy,this.stride=a.stride,this.in_depth=a.in_depth,this.filters=[],this.l1_decay_mul=void 0!==a.l1_decay_mul?a.l1_decay_mul:0,this.l2_decay_mul=void 0!==a.l2_decay_mul?a.l2_decay_mul:1,this.pad=void 0!==a.pad?a.pad:0;for(var i=0;i<a.filters.length;i++)this.filters.push(t.Vol.fromJSON(a.filters[i]));this.biases=t.Vol.fromJSON(a.biases)},i}(e.BaseLayer);e.ConvLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(a){var i=e.call(this,a||{})||this;return i.layer_type="dropout",i.drop_prob=t.getopt(a,["drop_prob"],.5),i.updateDimensions(a.pred),i}return __extends(i,e),i.prototype.forward=function(t,e){void 0===e&&(e=!1),this.in_act=t,this.resetGradient(),this.dropped=a.zeros(this.out_sx*this.out_sy*this.out_depth,Int8Array);var i=t.clone(),o=t.w.length;if(e)for(var n=0;n<o;n++)Math.random()<this.drop_prob?(i.w[n]=0,this.dropped[n]=1):i.w[n]*=this.drop_prob;return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++)1!==this.dropped[i]&&(t.dw[i]+=e.dw[i])},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.drop_prob=this.drop_prob,t},i.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.drop_prob=t.drop_prob},i}(e.BaseLayer);e.DropoutLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(a){var i=e.call(this,a||{})||this;i.layer_type="fc",i.sx=1,i.sy=1,i.conv_groups=1,i.out_depth=void 0!==a.num_neurons?a.num_neurons:a.filters,i.l1_decay_mul=t.getopt(a,["l1_decay_mul"],0),i.l2_decay_mul=t.getopt(a,["l2_decay_mul"],1),i.updateDimensions(a.pred);var o=t.getopt(a,["bias_pref"],0);i.biases=new t.Vol(1,1,i.out_depth,o),i.filters=[];for(n=0;n<i.out_depth;++n)i.filters.push(new t.Vol(1,1,i.num_inputs,0));if(void 0!==a.filters)for(var n=0;n<i.out_depth;++n)i.filters[n].w.set(a.filters[n]);return void 0!==a.biases&&i.biases.w.set(a.biases),i}return __extends(i,e),i.prototype.resetGradient=function(){e.prototype.resetGradient.call(this);for(var t=0;t<this.out_depth;++t)this.filters[t].dw=a.zeros(this.filters[t].w.length);this.biases.dw=a.zeros(this.out_depth)},i.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();for(var i=new t.Vol(1,1,this.out_depth,0),o=e.w,n=0;n<this.out_depth;++n){for(var r=0,s=this.filters[n].w,p=0;p<this.num_inputs;++p)r+=o[p]*s[p];r+=this.biases.w[n],i.w[n]=r}return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var t=this.in_act,e=0;e<this.out_depth;++e){for(var a=this.filters[e],i=this.out_act.dw[e],o=0;o<this.num_inputs;++o)t.dw[o]+=a.w[o]*i,a.dw[o]+=t.w[o]*i;this.biases.dw[e]+=i}},i.prototype.getParamsAndGrads=function(){for(var t=[],e=0;e<this.out_depth;++e)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth},i.prototype.getNumParameters=function(){return[this.in_depth*this.in_sx*this.in_sy*this.out_depth,this.out_depth]},i.prototype.getOutputShape=function(){return[this.out_depth,1,1]},i.prototype.getDescription=function(){return[this.layer_type.toUpperCase(),this.name,this.out_depth.toString()]},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var a=0;a<this.filters.length;a++)t.filters.push(this.filters[a].toJSON());return t.biases=this.biases.toJSON(),t},i.prototype.fromJSON=function(a){e.prototype.fromJSON.call(this,a),this.num_inputs=a.num_inputs,this.l1_decay_mul=void 0!==a.l1_decay_mul?a.l1_decay_mul:1,this.l2_decay_mul=void 0!==a.l2_decay_mul?a.l2_decay_mul:1,this.filters=[];for(var i=0;i<a.filters.length;i++)this.filters.push(t.Vol.fromJSON(a.filters[i]));this.biases=t.Vol.fromJSON(a.biases)},i}(e.BaseLayer);e.FullyConnectedLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=function(e){function a(a){var i=e.call(this,a||{})||this;return i.layer_type="input",i.in_depth=t.getopt(a,["in_depth","out_depth","depth"],0),i.in_sx=t.getopt(a,["in_sx","out_sx","sx","width"],1),i.in_sy=t.getopt(a,["in_sy","out_sy","sy","height"],1),i.updateDimensions(),i}return __extends(a,e),a.prototype.forward=function(t,e){return this.in_act=t,this.resetGradient(),this.out_act=t,this.out_act},a.prototype.backward=function(){},a}(e.BaseLayer);e.InputLayer=a}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(t){var e=function(t){function e(e){var a=t.call(this,e||{})||this;return a.layer_type="lrn",a.k=e.k,a.n=e.n,a.alpha=e.alpha,a.beta=e.beta,a.n%2==0&&console.warn("WARNING n should be odd for LRN layer"),a.updateDimensions(e.pred),a}return __extends(e,t),e.prototype.forward=function(t,e){this.in_act=t,this.resetGradient();var a=t.cloneAndZero();this.S_cache_=t.cloneAndZero();for(var i=Math.floor(this.n/2),o=0;o<t.sx;o++)for(var n=0;n<t.sy;n++)for(var r=0;r<t.depth;r++){for(var s=t.get(o,n,r),p=this.k,l=this.alpha/this.n,u=0,d=Math.max(0,r-i);d<=Math.min(r+i,t.depth-1);d++){var m=t.get(o,n,d);u+=m*m}var h=p+l*u;this.S_cache_.set(o,n,r,h);var f=s*Math.pow(h,-this.beta);a.set(o,n,r,f)}return this.out_act=a,this.out_act},e.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=Math.floor(this.n/2),i=0;i<t.sx;i++)for(var o=0;o<t.sy;o++)for(var n=0;n<t.depth;n++){for(var r=this.S_cache_.get(i,o,n),s=t.get(i,o,n),p=e.get_grad(i,o,n),l=Math.pow(r,-this.beta)*p,u=2*this.alpha*this.beta/this.n*s,d=0,m=Math.max(0,n-a);m<=Math.min(n+a,t.depth-1);m++){var h=e.get(i,o,m);d+=e.get_grad(i,o,m)*h/this.S_cache_.get(i,o,m)}var f=l-u*d;t.add_grad(i,o,n,f)}},e.prototype.getDescription=function(){return t.prototype.getDescription.call(this).concat(["n="+this.n+" k="+this.k])},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.k=this.k,e.n=this.n,e.alpha=this.alpha,e.beta=this.beta,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.k=e.k,this.n=e.n,this.alpha=e.alpha,this.beta=e.beta},e}(t.BaseLayer);t.LocalResponseNormalizationLayer=e}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(t){var a=e.call(this,t||{})||this;return a.layer_type="maxout",a.group_size=void 0!==t.group_size?t.group_size:2,a.updateDimensions(t.pred),a}return __extends(i,e),i.prototype.forward=function(e,i){this.in_act=e,this.resetGradient(),this.switches=a.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array);var o=this.out_depth,n=new t.Vol(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(h=0;h<o;h++){for(var r=h*this.group_size,s=e.w[r],p=0,l=1;l<this.group_size;l++)(f=e.w[r+l])>s&&(s=f,p=l);n.w[h]=s,this.switches[h]=r+p}else for(var u=0,d=0;d<e.sx;d++)for(var m=0;m<e.sy;m++)for(var h=0;h<o;h++){for(var r=h*this.group_size,s=e.get(d,m,r),p=0,l=1;l<this.group_size;l++){var f=e.get(d,m,r+l);f>s&&(s=f,p=l)}n.set(d,m,h,s),this.switches[u]=r+p,u++}return this.out_act=n,this.out_act},i.prototype.backward=function(){var t=this.in_act,e=this.out_act,a=this.out_depth;if(1===this.out_sx&&1===this.out_sy)for(r=0;r<a;r++){s=e.dw[r];t.dw[this.switches[r]]+=s}else for(var i=0,o=0;o<e.sx;o++)for(var n=0;n<e.sy;n++)for(var r=0;r<a;r++){var s=e.get_grad(o,n,r);t.add_grad(o,n,this.switches[i],s),i++}},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=Math.floor(this.in_depth/this.group_size)},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.group_size=this.group_size,t},i.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.group_size=t.group_size},i}(e.BaseLayer);e.MaxoutLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(a){var i=e.call(this,a||{})||this;return i.layer_type="pool",i.out_depth=a.filters,i.pool=t.getopt(a,["pool"],"MAX"),t.getopt(a,["global_pooling"],!1)?(i.sx=a.pred[0].out_sx,i.sy=a.pred[0].out_sy):(i.sx=a.sx,i.sy=t.getopt(a,["sy"],i.sx)),i.stride=t.getopt(a,["stride"],1),i.pad=t.getopt(a,["pad"],0),i.updateDimensions(a.pred),i}return __extends(i,e),i.prototype.forward=function(e,i){this.in_act=e,this.resetGradient(),this.switchx=a.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=a.zeros(this.out_sx*this.out_sy*this.out_depth);var o=new t.Vol(this.out_sx,this.out_sy,this.out_depth,0);if("AVE"===this.pool){this.sx,this.sy;for(var n=0;n<this.out_depth;++n)for(var r=0;r<this.out_sx;++r)for(var s=0;s<this.out_sy;++s){var p=0,l=r*this.stride-this.pad,u=s*this.stride-this.pad,d=Math.min(l+this.sx,e.sx+this.pad),m=Math.min(u+this.sy,e.sy+this.pad);l=Math.max(l,0),u=Math.max(u,0);for(var h=((d=Math.min(d,e.sx))-l)*((m=Math.min(m,e.sy))-u),f=l;f<d;++f)for(var y=u;y<m;++y)p+=e.get(f,y,n);o.set(r,s,n,p/h)}}else for(var _=0,c=0;c<this.out_depth;++c)for(var v=-this.pad,g=-this.pad,w=0;w<this.out_sx;v+=this.stride,w++){g=-this.pad;for(var P=0;P<this.out_sy;g+=this.stride,P++){for(var N=-99999,x=-1,S=-1,b=0;b<this.sx;++b)for(var L=0;L<this.sy;++L){var A=g+L,E=v+b;if(A>=0&&A<e.sy&&E>=0&&E<e.sx){var D=e.get(E,A,c);D>N&&(N=D,x=E,S=A)}}this.switchx[_]=x,this.switchy[_]=S,_++,o.set(w,P,c,N)}}return this.out_act=o,this.out_act},i.prototype.backward=function(){var t=this.in_act;this.out_act;if("AVE"===this.pool);else for(var e=0,a=0;a<this.out_depth;++a){this.pad;for(var i=0;i<this.out_sx;this.stride,i++){this.pad;for(var o=0;o<this.out_sy;this.stride,o++){var n=this.out_act.get_grad(i,o,a);t.add_grad(this.switchx[e],this.switchy[e],a,n),e++}}}},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth);var e=this.getOutputShape();this.out_sx=e[1],this.out_sy=e[2],this.out_depth=this.in_depth},i.prototype.getOutputShape=function(){return[this.out_depth,Math.ceil((this.in_sx+2*this.pad-this.sx)/this.stride+1),Math.ceil((this.in_sy+2*this.pad-this.sy)/this.stride+1)]},i.prototype.getDescription=function(){return[this.pool+" "+this.layer_type.toUpperCase(),this.name,[this.sy,this.sx].join("x")+" stride="+this.stride+" pad="+this.pad]},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.pool=this.pool,t.in_depth=this.in_depth,t.pad=this.pad,t},i.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.pool=void 0!==t.pool?t.pool:"MAX",this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.pad=void 0!==t.pad?t.pad:0,this.switchx=a.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array),this.switchy=a.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array)},i}(e.BaseLayer);e.PoolLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(t){var e=function(t){function e(e){var a=t.call(this,e||{})||this;return a.layer_type="regression",a.updateDimensions(e.pred),a}return __extends(e,t),e.prototype.forward=function(t,e){return this.in_act=t,this.resetGradient(),this.out_act=t,t},e.prototype.backward=function(t){var e=this.in_act,a=0;if(t instanceof Float32Array)for(i=0;i<this.out_depth;i++){n=e.w[i]-t[i];e.dw[i]=n,a+=.5*n*n}else if("number"==typeof t){n=e.w[0]-t;e.dw[0]=n,a+=.5*n*n}else{var i=t.dim,o=t.val,n=e.w[i]-o;e.dw[i]=n,a+=.5*n*n}return a},e.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},e.prototype.getOutputShape=function(){return[this.out_depth,1,1]},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.num_inputs=this.num_inputs,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.num_inputs=e.num_inputs},e}(t.BaseLayer);t.RegressionLayer=e}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(t){var e=function(t){function e(e){var a=t.call(this,e||{})||this;return a.layer_type="relu",a.updateDimensions(e.pred),a}return __extends(e,t),e.prototype.forward=function(t,e){this.in_act=t,this.resetGradient();for(var a=t.clone(),i=t.w.length,o=a.w,n=0;n<i;n++)o[n]<0&&(o[n]=0);return this.out_act=a,this.out_act},e.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++)e.w[i]<=0?t.dw[i]=0:t.dw[i]+=e.dw[i]},e}(t.BaseLayer);t.ReluLayer=e}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(t){var e=function(t){function e(e){var a=t.call(this,e||{})||this;return a.layer_type="svm",a.updateDimensions(e.pred),a}return __extends(e,t),e.prototype.forward=function(t,e){return this.in_act=t,this.resetGradient(),this.out_act=t,t},e.prototype.backward=function(t){for(var e=this.in_act,a=e.w[t],i=0,o=0;o<this.out_depth;o++)if(t!==o){var n=-a+e.w[o]+1;n>0&&(e.dw[o]+=1,e.dw[t]-=1,i+=n)}return i},e.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},e.prototype.getOutputShape=function(){return[this.out_depth,1,1]},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.num_inputs=this.num_inputs,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.num_inputs=e.num_inputs},e}(t.BaseLayer);t.SVMLayer=e}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(t){var e=function(t){function e(e){var a=t.call(this,e||{})||this;return a.layer_type="sigmoid",a.updateDimensions(e.pred),a}return __extends(e,t),e.prototype.forward=function(t,e){this.in_act=t,this.resetGradient();for(var a=t.cloneAndZero(),i=t.w.length,o=a.w,n=t.w,r=0;r<i;r++)o[r]=1/(1+Math.exp(-n[r]));return this.out_act=a,this.out_act},e.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++){var o=e.w[i];t.dw[i]+=o*(1-o)*e.dw[i]}},e}(t.BaseLayer);t.SigmoidLayer=e}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(e){var a=NumJS,i=function(e){function i(t){var a=e.call(this,t||{})||this;return a.layer_type="softmax",a.updateDimensions(t.pred),a}return __extends(i,e),i.prototype.forward=function(e,i){this.in_act=e,this.resetGradient();for(var o=new t.Vol(1,1,this.out_depth,0),n=e.w,r=e.w[0],s=1;s<this.out_depth;s++)n[s]>r&&(r=n[s]);for(var p=a.zeros(this.out_depth),l=0,s=0;s<this.out_depth;s++){var u=Math.exp(n[s]-r);l+=u,p[s]=u}for(s=0;s<this.out_depth;s++)p[s]/=l,o.w[s]=p[s];return this.es=p,this.out_act=o,this.out_act},i.prototype.backward=function(t){for(var e=this.in_act,a=0;a<this.out_depth;a++){var i=-((a===t?1:0)-this.es[a]);e.dw[a]+=i}return-Math.log(this.es[t])},i.prototype.updateDimensions=function(t){t&&(this.in_sx=t[0].out_sx,this.in_sy=t[0].out_sy,this.in_depth=t[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},i.prototype.getOutputShape=function(){return[this.out_depth,1,1]},i.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.num_inputs=this.num_inputs,t},i.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.num_inputs=t.num_inputs},i}(e.BaseLayer);e.SoftmaxLayer=i}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Net;!function(t){!function(t){var e=NumJS,a=function(t){function a(e){var a=t.call(this,e||{})||this;return a.layer_type="tanh",a.updateDimensions(e.pred),a}return __extends(a,t),a.prototype.forward=function(t,a){this.in_act=t,this.resetGradient();for(var i=t.cloneAndZero(),o=t.w.length,n=0;n<o;n++)i.w[n]=e.tanh(t.w[n]);return this.out_act=i,this.out_act},a.prototype.backward=function(){for(var t=this.in_act,e=this.out_act,a=t.w.length,i=0;i<a;i++){var o=e.w[i];t.dw[i]+=(1-o*o)*e.dw[i]}},a}(t.BaseLayer);t.TanhLayer=a}(t.Layers||(t.Layers={}))}(Net||(Net={}));var Parser;!function(t){var e=function(){function t(){}return t.prototype.fetch=function(t){var e=new Request(t);return fetch(e).then(function(t){return t.text()})},t.prototype.parse=function(t){var e=this;return this.fetch(t).then(function(t){return e.parseString(t)})},t}();t.TextParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(){function t(){}return t.prototype.fetch=function(t){var e=new Request(t);return fetch(e).then(function(t){return t.arrayBuffer()})},t.prototype.parse=function(t){var e=this;return this.fetch(t).then(function(t){return e.parseBuffer(t)})},t}();t.BinaryParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parseBuffer=function(t){var e=dcodeIO.ProtoBuf.newBuilder({}).import({package:"caffe",messages:[{name:"BlobShape",fields:[{rule:"repeated",type:"int64",name:"dim",id:1,options:{packed:!0}}]},{name:"BlobProto",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:7},{rule:"repeated",type:"float",name:"data",id:5,options:{packed:!0}},{rule:"repeated",type:"float",name:"diff",id:6,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_data",id:8,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_diff",id:9,options:{packed:!0}},{rule:"optional",type:"int32",name:"num",id:1,options:{default:0}},{rule:"optional",type:"int32",name:"channels",id:2,options:{default:0}},{rule:"optional",type:"int32",name:"height",id:3,options:{default:0}},{rule:"optional",type:"int32",name:"width",id:4,options:{default:0}}]},{name:"BlobProtoVector",fields:[{rule:"repeated",type:"BlobProto",name:"blobs",id:1}]},{name:"Datum",fields:[{rule:"optional",type:"int32",name:"channels",id:1},{rule:"optional",type:"int32",name:"height",id:2},{rule:"optional",type:"int32",name:"width",id:3},{rule:"optional",type:"bytes",name:"data",id:4},{rule:"optional",type:"int32",name:"label",id:5},{rule:"repeated",type:"float",name:"float_data",id:6},{rule:"optional",type:"bool",name:"encoded",id:7,options:{default:!1}}]},{name:"FillerParameter",fields:[{rule:"optional",type:"string",name:"type",id:1,options:{default:"constant"}},{rule:"optional",type:"float",name:"value",id:2,options:{default:0}},{rule:"optional",type:"float",name:"min",id:3,options:{default:0}},{rule:"optional",type:"float",name:"max",id:4,options:{default:1}},{rule:"optional",type:"float",name:"mean",id:5,options:{default:0}},{rule:"optional",type:"float",name:"std",id:6,options:{default:1}},{rule:"optional",type:"int32",name:"sparse",id:7,options:{default:-1}},{rule:"optional",type:"VarianceNorm",name:"variance_norm",id:8,options:{default:"FAN_IN"}}],enums:[{name:"VarianceNorm",values:[{name:"FAN_IN",id:0},{name:"FAN_OUT",id:1},{name:"AVERAGE",id:2}]}]},{name:"NetParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"repeated",type:"string",name:"input",id:3},{rule:"repeated",type:"BlobShape",name:"input_shape",id:8},{rule:"repeated",type:"int32",name:"input_dim",id:4},{rule:"optional",type:"bool",name:"force_backward",id:5,options:{default:!1}},{rule:"optional",type:"NetState",name:"state",id:6},{rule:"optional",type:"bool",name:"debug_info",id:7,options:{default:!1}},{rule:"repeated",type:"LayerParameter",name:"layer",id:100},{rule:"repeated",type:"V1LayerParameter",name:"layers",id:2}]},{name:"SolverParameter",fields:[{rule:"optional",type:"string",name:"net",id:24},{rule:"optional",type:"NetParameter",name:"net_param",id:25},{rule:"optional",type:"string",name:"train_net",id:1},{rule:"repeated",type:"string",name:"test_net",id:2},{rule:"optional",type:"NetParameter",name:"train_net_param",id:21},{rule:"repeated",type:"NetParameter",name:"test_net_param",id:22},{rule:"optional",type:"NetState",name:"train_state",id:26},{rule:"repeated",type:"NetState",name:"test_state",id:27},{rule:"repeated",type:"int32",name:"test_iter",id:3},{rule:"optional",type:"int32",name:"test_interval",id:4,options:{default:0}},{rule:"optional",type:"bool",name:"test_compute_loss",id:19,options:{default:!1}},{rule:"optional",type:"bool",name:"test_initialization",id:32,options:{default:!0}},{rule:"optional",type:"float",name:"base_lr",id:5},{rule:"optional",type:"int32",name:"display",id:6},{rule:"optional",type:"int32",name:"average_loss",id:33,options:{default:1}},{rule:"optional",type:"int32",name:"max_iter",id:7},{rule:"optional",type:"int32",name:"iter_size",id:36,options:{default:1}},{rule:"optional",type:"string",name:"lr_policy",id:8},{rule:"optional",type:"float",name:"gamma",id:9},{rule:"optional",type:"float",name:"power",id:10},{rule:"optional",type:"float",name:"momentum",id:11},{rule:"optional",type:"float",name:"weight_decay",id:12},{rule:"optional",type:"string",name:"regularization_type",id:29,options:{default:"L2"}},{rule:"optional",type:"int32",name:"stepsize",id:13},{rule:"repeated",type:"int32",name:"stepvalue",id:34},{rule:"optional",type:"float",name:"clip_gradients",id:35,options:{default:-1}},{rule:"optional",type:"int32",name:"snapshot",id:14,options:{default:0}},{rule:"optional",type:"string",name:"snapshot_prefix",id:15},{rule:"optional",type:"bool",name:"snapshot_diff",id:16,options:{default:!1}},{rule:"optional",type:"SnapshotFormat",name:"snapshot_format",id:37,options:{default:"BINARYPROTO"}},{rule:"optional",type:"SolverMode",name:"solver_mode",id:17,options:{default:"GPU"}},{rule:"optional",type:"int32",name:"device_id",id:18,options:{default:0}},{rule:"optional",type:"int64",name:"random_seed",id:20,options:{default:-1}},{rule:"optional",type:"string",name:"type",id:40,options:{default:"SGD"}},{rule:"optional",type:"float",name:"delta",id:31,options:{default:1e-8}},{rule:"optional",type:"float",name:"momentum2",id:39,options:{default:.999}},{rule:"optional",type:"float",name:"rms_decay",id:38},{rule:"optional",type:"bool",name:"debug_info",id:23,options:{default:!1}},{rule:"optional",type:"bool",name:"snapshot_after_train",id:28,options:{default:!0}},{rule:"optional",type:"SolverType",name:"solver_type",id:30,options:{default:"SGD"}}],enums:[{name:"SnapshotFormat",values:[{name:"HDF5",id:0},{name:"BINARYPROTO",id:1}]},{name:"SolverMode",values:[{name:"CPU",id:0},{name:"GPU",id:1}]},{name:"SolverType",values:[{name:"SGD",id:0},{name:"NESTEROV",id:1},{name:"ADAGRAD",id:2},{name:"RMSPROP",id:3},{name:"ADADELTA",id:4},{name:"ADAM",id:5}]}]},{name:"SolverState",fields:[{rule:"optional",type:"int32",name:"iter",id:1},{rule:"optional",type:"string",name:"learned_net",id:2},{rule:"repeated",type:"BlobProto",name:"history",id:3},{rule:"optional",type:"int32",name:"current_step",id:4,options:{default:0}}]},{name:"NetState",fields:[{rule:"optional",type:"Phase",name:"phase",id:1,options:{default:"TEST"}},{rule:"optional",type:"int32",name:"level",id:2,options:{default:0}},{rule:"repeated",type:"string",name:"stage",id:3}]},{name:"NetStateRule",fields:[{rule:"optional",type:"Phase",name:"phase",id:1},{rule:"optional",type:"int32",name:"min_level",id:2},{rule:"optional",type:"int32",name:"max_level",id:3},{rule:"repeated",type:"string",name:"stage",id:4},{rule:"repeated",type:"string",name:"not_stage",id:5}]},{name:"ParamSpec",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"DimCheckMode",name:"share_mode",id:2},{rule:"optional",type:"float",name:"lr_mult",id:3,options:{default:1}},{rule:"optional",type:"float",name:"decay_mult",id:4,options:{default:1}}],enums:[{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"repeated",type:"string",name:"bottom",id:3},{rule:"repeated",type:"string",name:"top",id:4},{rule:"optional",type:"Phase",name:"phase",id:10},{rule:"repeated",type:"float",name:"loss_weight",id:5},{rule:"repeated",type:"ParamSpec",name:"param",id:6},{rule:"repeated",type:"BlobProto",name:"blobs",id:7},{rule:"repeated",type:"bool",name:"propagate_down",id:11},{rule:"repeated",type:"NetStateRule",name:"include",id:8},{rule:"repeated",type:"NetStateRule",name:"exclude",id:9},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:100},{rule:"optional",type:"LossParameter",name:"loss_param",id:101},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:102},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:103},{rule:"optional",type:"BatchNormParameter",name:"batch_norm_param",id:139},{rule:"optional",type:"BiasParameter",name:"bias_param",id:141},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:104},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:105},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:106},{rule:"optional",type:"CropParameter",name:"crop_param",id:144},{rule:"optional",type:"DataParameter",name:"data_param",id:107},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:108},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:109},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:110},{rule:"optional",type:"ELUParameter",name:"elu_param",id:140},{rule:"optional",type:"EmbedParameter",name:"embed_param",id:137},{rule:"optional",type:"ExpParameter",name:"exp_param",id:111},{rule:"optional",type:"FlattenParameter",name:"flatten_param",id:135},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:112},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:113},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:114},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:115},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:116},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:117},{rule:"optional",type:"InputParameter",name:"input_param",id:143},{rule:"optional",type:"LogParameter",name:"log_param",id:134},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:118},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:119},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:120},{rule:"optional",type:"ParameterParameter",name:"parameter_param",id:145},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:121},{rule:"optional",type:"PowerParameter",name:"power_param",id:122},{rule:"optional",type:"PReLUParameter",name:"prelu_param",id:131},{rule:"optional",type:"PythonParameter",name:"python_param",id:130},{rule:"optional",type:"ReductionParameter",name:"reduction_param",id:136},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:123},{rule:"optional",type:"ReshapeParameter",name:"reshape_param",id:133},{rule:"optional",type:"ScaleParameter",name:"scale_param",id:142},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:124},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:125},{rule:"optional",type:"SPPParameter",name:"spp_param",id:132},{rule:"optional",type:"SliceParameter",name:"slice_param",id:126},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:127},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:128},{rule:"optional",type:"TileParameter",name:"tile_param",id:138},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:129}]},{name:"TransformationParameter",fields:[{rule:"optional",type:"float",name:"scale",id:1,options:{default:1}},{rule:"optional",type:"bool",name:"mirror",id:2,options:{default:!1}},{rule:"optional",type:"uint32",name:"crop_size",id:3,options:{default:0}},{rule:"optional",type:"string",name:"mean_file",id:4},{rule:"repeated",type:"float",name:"mean_value",id:5},{rule:"optional",type:"bool",name:"force_color",id:6,options:{default:!1}},{rule:"optional",type:"bool",name:"force_gray",id:7,options:{default:!1}}]},{name:"LossParameter",fields:[{rule:"optional",type:"int32",name:"ignore_label",id:1},{rule:"optional",type:"NormalizationMode",name:"normalization",id:3,options:{default:"VALID"}},{rule:"optional",type:"bool",name:"normalize",id:2}],enums:[{name:"NormalizationMode",values:[{name:"FULL",id:0},{name:"VALID",id:1},{name:"BATCH_SIZE",id:2},{name:"NONE",id:3}]}]},{name:"AccuracyParameter",fields:[{rule:"optional",type:"uint32",name:"top_k",id:1,options:{default:1}},{rule:"optional",type:"int32",name:"axis",id:2,options:{default:1}},{rule:"optional",type:"int32",name:"ignore_label",id:3}]},{name:"ArgMaxParameter",fields:[{rule:"optional",type:"bool",name:"out_max_val",id:1,options:{default:!1}},{rule:"optional",type:"uint32",name:"top_k",id:2,options:{default:1}},{rule:"optional",type:"int32",name:"axis",id:3}]},{name:"ConcatParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:2,options:{default:1}},{rule:"optional",type:"uint32",name:"concat_dim",id:1,options:{default:1}}]},{name:"BatchNormParameter",fields:[{rule:"optional",type:"bool",name:"use_global_stats",id:1},{rule:"optional",type:"float",name:"moving_average_fraction",id:2,options:{default:.999}},{rule:"optional",type:"float",name:"eps",id:3,options:{default:1e-5}}]},{name:"BiasParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{default:1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{default:1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3}]},{name:"ContrastiveLossParameter",fields:[{rule:"optional",type:"float",name:"margin",id:1,options:{default:1}},{rule:"optional",type:"bool",name:"legacy_version",id:2,options:{default:!1}}]},{name:"ConvolutionParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{default:!0}},{rule:"repeated",type:"uint32",name:"pad",id:3},{rule:"repeated",type:"uint32",name:"kernel_size",id:4},{rule:"repeated",type:"uint32",name:"stride",id:6},{rule:"repeated",type:"uint32",name:"dilation",id:18},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{default:0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{default:0}},{rule:"optional",type:"uint32",name:"kernel_h",id:11},{rule:"optional",type:"uint32",name:"kernel_w",id:12},{rule:"optional",type:"uint32",name:"stride_h",id:13},{rule:"optional",type:"uint32",name:"stride_w",id:14},{rule:"optional",type:"uint32",name:"group",id:5,options:{default:1}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:7},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:8},{rule:"optional",type:"Engine",name:"engine",id:15,options:{default:"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:16,options:{default:1}},{rule:"optional",type:"bool",name:"force_nd_im2col",id:17,options:{default:!1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"CropParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{default:2}},{rule:"repeated",type:"uint32",name:"offset",id:2}]},{name:"DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{default:0}},{rule:"optional",type:"DB",name:"backend",id:8,options:{default:"LEVELDB"}},{rule:"optional",type:"float",name:"scale",id:2,options:{default:1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{default:0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{default:!1}},{rule:"optional",type:"bool",name:"force_encoded_color",id:9,options:{default:!1}},{rule:"optional",type:"uint32",name:"prefetch",id:10,options:{default:4}}],enums:[{name:"DB",values:[{name:"LEVELDB",id:0},{name:"LMDB",id:1}]}]},{name:"DropoutParameter",fields:[{rule:"optional",type:"float",name:"dropout_ratio",id:1,options:{default:.5}}]},{name:"DummyDataParameter",fields:[{rule:"repeated",type:"FillerParameter",name:"data_filler",id:1},{rule:"repeated",type:"BlobShape",name:"shape",id:6},{rule:"repeated",type:"uint32",name:"num",id:2},{rule:"repeated",type:"uint32",name:"channels",id:3},{rule:"repeated",type:"uint32",name:"height",id:4},{rule:"repeated",type:"uint32",name:"width",id:5}]},{name:"EltwiseParameter",fields:[{rule:"optional",type:"EltwiseOp",name:"operation",id:1,options:{default:"SUM"}},{rule:"repeated",type:"float",name:"coeff",id:2},{rule:"optional",type:"bool",name:"stable_prod_grad",id:3,options:{default:!0}}],enums:[{name:"EltwiseOp",values:[{name:"PROD",id:0},{name:"SUM",id:1},{name:"MAX",id:2}]}]},{name:"ELUParameter",fields:[{rule:"optional",type:"float",name:"alpha",id:1,options:{default:1}}]},{name:"EmbedParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"uint32",name:"input_dim",id:2},{rule:"optional",type:"bool",name:"bias_term",id:3,options:{default:!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:4},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"ExpParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{default:-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{default:1}},{rule:"optional",type:"float",name:"shift",id:3,options:{default:0}}]},{name:"FlattenParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{default:1}},{rule:"optional",type:"int32",name:"end_axis",id:2,options:{default:-1}}]},{name:"HDF5DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:2},{rule:"optional",type:"bool",name:"shuffle",id:3,options:{default:!1}}]},{name:"HDF5OutputParameter",fields:[{rule:"optional",type:"string",name:"file_name",id:1}]},{name:"HingeLossParameter",fields:[{rule:"optional",type:"Norm",name:"norm",id:1,options:{default:"L1"}}],enums:[{name:"Norm",values:[{name:"L1",id:1},{name:"L2",id:2}]}]},{name:"ImageDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4,options:{default:1}},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{default:0}},{rule:"optional",type:"bool",name:"shuffle",id:8,options:{default:!1}},{rule:"optional",type:"uint32",name:"new_height",id:9,options:{default:0}},{rule:"optional",type:"uint32",name:"new_width",id:10,options:{default:0}},{rule:"optional",type:"bool",name:"is_color",id:11,options:{default:!0}},{rule:"optional",type:"float",name:"scale",id:2,options:{default:1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{default:0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{default:!1}},{rule:"optional",type:"string",name:"root_folder",id:12,options:{default:""}}]},{name:"InfogainLossParameter",fields:[{rule:"optional",type:"string",name:"source",id:1}]},{name:"InnerProductParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{default:!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:3},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:4},{rule:"optional",type:"int32",name:"axis",id:5,options:{default:1}},{rule:"optional",type:"bool",name:"transpose",id:6,options:{default:!1}}]},{name:"InputParameter",fields:[{rule:"repeated",type:"BlobShape",name:"shape",id:1}]},{name:"LogParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{default:-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{default:1}},{rule:"optional",type:"float",name:"shift",id:3,options:{default:0}}]},{name:"LRNParameter",fields:[{rule:"optional",type:"uint32",name:"local_size",id:1,options:{default:5}},{rule:"optional",type:"float",name:"alpha",id:2,options:{default:1}},{rule:"optional",type:"float",name:"beta",id:3,options:{default:.75}},{rule:"optional",type:"NormRegion",name:"norm_region",id:4,options:{default:"ACROSS_CHANNELS"}},{rule:"optional",type:"float",name:"k",id:5,options:{default:1}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{default:"DEFAULT"}}],enums:[{name:"NormRegion",values:[{name:"ACROSS_CHANNELS",id:0},{name:"WITHIN_CHANNEL",id:1}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"MemoryDataParameter",fields:[{rule:"optional",type:"uint32",name:"batch_size",id:1},{rule:"optional",type:"uint32",name:"channels",id:2},{rule:"optional",type:"uint32",name:"height",id:3},{rule:"optional",type:"uint32",name:"width",id:4}]},{name:"MVNParameter",fields:[{rule:"optional",type:"bool",name:"normalize_variance",id:1,options:{default:!0}},{rule:"optional",type:"bool",name:"across_channels",id:2,options:{default:!1}},{rule:"optional",type:"float",name:"eps",id:3,options:{default:1e-9}}]},{name:"ParameterParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1}]},{name:"PoolingParameter",fields:[{rule:"optional",type:"PoolMethod",name:"pool",id:1,options:{default:"MAX"}},{rule:"optional",type:"uint32",name:"pad",id:4,options:{default:0}},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{default:0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{default:0}},{rule:"optional",type:"uint32",name:"kernel_size",id:2},{rule:"optional",type:"uint32",name:"kernel_h",id:5},{rule:"optional",type:"uint32",name:"kernel_w",id:6},{rule:"optional",type:"uint32",name:"stride",id:3,options:{default:1}},{rule:"optional",type:"uint32",name:"stride_h",id:7},{rule:"optional",type:"uint32",name:"stride_w",id:8},{rule:"optional",type:"Engine",name:"engine",id:11,options:{default:"DEFAULT"}},{rule:"optional",type:"bool",name:"global_pooling",id:12,options:{default:!1}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"PowerParameter",fields:[{rule:"optional",type:"float",name:"power",id:1,options:{default:1}},{rule:"optional",type:"float",name:"scale",id:2,options:{default:1}},{rule:"optional",type:"float",name:"shift",id:3,options:{default:0}}]},{name:"PythonParameter",fields:[{rule:"optional",type:"string",name:"module",id:1},{rule:"optional",type:"string",name:"layer",id:2},{rule:"optional",type:"string",name:"param_str",id:3,options:{default:""}},{rule:"optional",type:"bool",name:"share_in_parallel",id:4,options:{default:!1}}]},{name:"ReductionParameter",fields:[{rule:"optional",type:"ReductionOp",name:"operation",id:1,options:{default:"SUM"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{default:0}},{rule:"optional",type:"float",name:"coeff",id:3,options:{default:1}}],enums:[{name:"ReductionOp",values:[{name:"SUM",id:1},{name:"ASUM",id:2},{name:"SUMSQ",id:3},{name:"MEAN",id:4}]}]},{name:"ReLUParameter",fields:[{rule:"optional",type:"float",name:"negative_slope",id:1,options:{default:0}},{rule:"optional",type:"Engine",name:"engine",id:2,options:{default:"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"ReshapeParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1},{rule:"optional",type:"int32",name:"axis",id:2,options:{default:0}},{rule:"optional",type:"int32",name:"num_axes",id:3,options:{default:-1}}]},{name:"ScaleParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{default:1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{default:1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3},{rule:"optional",type:"bool",name:"bias_term",id:4,options:{default:!1}},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"SigmoidParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{default:"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"SliceParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:3,options:{default:1}},{rule:"repeated",type:"uint32",name:"slice_point",id:2},{rule:"optional",type:"uint32",name:"slice_dim",id:1,options:{default:1}}]},{name:"SoftmaxParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{default:"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{default:1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TanHParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{default:"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TileParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{default:1}},{rule:"optional",type:"int32",name:"tiles",id:2}]},{name:"ThresholdParameter",fields:[{rule:"optional",type:"float",name:"threshold",id:1,options:{default:0}}]},{name:"WindowDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"float",name:"scale",id:2,options:{default:1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{default:0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{default:!1}},{rule:"optional",type:"float",name:"fg_threshold",id:7,options:{default:.5}},{rule:"optional",type:"float",name:"bg_threshold",id:8,options:{default:.5}},{rule:"optional",type:"float",name:"fg_fraction",id:9,options:{default:.25}},{rule:"optional",type:"uint32",name:"context_pad",id:10,options:{default:0}},{rule:"optional",type:"string",name:"crop_mode",id:11,options:{default:"warp"}},{rule:"optional",type:"bool",name:"cache_images",id:12,options:{default:!1}},{rule:"optional",type:"string",name:"root_folder",id:13,options:{default:""}}]},{name:"SPPParameter",fields:[{rule:"optional",type:"uint32",name:"pyramid_height",id:1},{rule:"optional",type:"PoolMethod",name:"pool",id:2,options:{default:"MAX"}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{default:"DEFAULT"}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"V1LayerParameter",fields:[{rule:"repeated",type:"string",name:"bottom",id:2},{rule:"repeated",type:"string",name:"top",id:3},{rule:"optional",type:"string",name:"name",id:4},{rule:"repeated",type:"NetStateRule",name:"include",id:32},{rule:"repeated",type:"NetStateRule",name:"exclude",id:33},{rule:"optional",type:"LayerType",name:"type",id:5},{rule:"repeated",type:"BlobProto",name:"blobs",id:6},{rule:"repeated",type:"string",name:"param",id:1001},{rule:"repeated",type:"DimCheckMode",name:"blob_share_mode",id:1002},{rule:"repeated",type:"float",name:"blobs_lr",id:7},{rule:"repeated",type:"float",name:"weight_decay",id:8},{rule:"repeated",type:"float",name:"loss_weight",id:35},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:27},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:23},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:9},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:40},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:10},{rule:"optional",type:"DataParameter",name:"data_param",id:11},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:12},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:26},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:24},{rule:"optional",type:"ExpParameter",name:"exp_param",id:41},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:13},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:14},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:29},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:15},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:16},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:17},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:18},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:22},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:34},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:19},{rule:"optional",type:"PowerParameter",name:"power_param",id:21},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:30},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:38},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:39},{rule:"optional",type:"SliceParameter",name:"slice_param",id:31},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:37},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:25},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:20},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:36},{rule:"optional",type:"LossParameter",name:"loss_param",id:42},{rule:"optional",type:"V0LayerParameter",name:"layer",id:1}],enums:[{name:"LayerType",values:[{name:"NONE",id:0},{name:"ABSVAL",id:35},{name:"ACCURACY",id:1},{name:"ARGMAX",id:30},{name:"BNLL",id:2},{name:"CONCAT",id:3},{name:"CONTRASTIVE_LOSS",id:37},{name:"CONVOLUTION",id:4},{name:"DATA",id:5},{name:"DECONVOLUTION",id:39},{name:"DROPOUT",id:6},{name:"DUMMY_DATA",id:32},{name:"EUCLIDEAN_LOSS",id:7},{name:"ELTWISE",id:25},{name:"EXP",id:38},{name:"FLATTEN",id:8},{name:"HDF5_DATA",id:9},{name:"HDF5_OUTPUT",id:10},{name:"HINGE_LOSS",id:28},{name:"IM2COL",id:11},{name:"IMAGE_DATA",id:12},{name:"INFOGAIN_LOSS",id:13},{name:"INNER_PRODUCT",id:14},{name:"LRN",id:15},{name:"MEMORY_DATA",id:29},{name:"MULTINOMIAL_LOGISTIC_LOSS",id:16},{name:"MVN",id:34},{name:"POOLING",id:17},{name:"POWER",id:26},{name:"RELU",id:18},{name:"SIGMOID",id:19},{name:"SIGMOID_CROSS_ENTROPY_LOSS",id:27},{name:"SILENCE",id:36},{name:"SOFTMAX",id:20},{name:"SOFTMAX_LOSS",id:21},{name:"SPLIT",id:22},{name:"SLICE",id:33},{name:"TANH",id:23},{name:"WINDOW_DATA",id:24},{name:"THRESHOLD",id:31}]},{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"V0LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"uint32",name:"num_output",id:3},{rule:"optional",type:"bool",name:"biasterm",id:4,options:{default:!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:5},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:6},{rule:"optional",type:"uint32",name:"pad",id:7,options:{default:0}},{rule:"optional",type:"uint32",name:"kernelsize",id:8},{rule:"optional",type:"uint32",name:"group",id:9,options:{default:1}},{rule:"optional",type:"uint32",name:"stride",id:10,options:{default:1}},{rule:"optional",type:"PoolMethod",name:"pool",id:11,options:{default:"MAX"}},{rule:"optional",type:"float",name:"dropout_ratio",id:12,options:{default:.5}},{rule:"optional",type:"uint32",name:"local_size",id:13,options:{default:5}},{rule:"optional",type:"float",name:"alpha",id:14,options:{default:1}},{rule:"optional",type:"float",name:"beta",id:15,options:{default:.75}},{rule:"optional",type:"float",name:"k",id:22,options:{default:1}},{rule:"optional",type:"string",name:"source",id:16},{rule:"optional",type:"float",name:"scale",id:17,options:{default:1}},{rule:"optional",type:"string",name:"meanfile",id:18},{rule:"optional",type:"uint32",name:"batchsize",id:19},{rule:"optional",type:"uint32",name:"cropsize",id:20,options:{default:0}},{rule:"optional",type:"bool",name:"mirror",id:21,options:{default:!1}},{rule:"repeated",type:"BlobProto",name:"blobs",id:50},{rule:"repeated",type:"float",name:"blobs_lr",id:51},{rule:"repeated",type:"float",name:"weight_decay",id:52},{rule:"optional",type:"uint32",name:"rand_skip",id:53,options:{default:0}},{rule:"optional",type:"float",name:"det_fg_threshold",id:54,options:{default:.5}},{rule:"optional",type:"float",name:"det_bg_threshold",id:55,options:{default:.5}},{rule:"optional",type:"float",name:"det_fg_fraction",id:56,options:{default:.25}},{rule:"optional",type:"uint32",name:"det_context_pad",id:58,options:{default:0}},{rule:"optional",type:"string",name:"det_crop_mode",id:59,options:{default:"warp"}},{rule:"optional",type:"int32",name:"new_num",id:60,options:{default:0}},{rule:"optional",type:"int32",name:"new_channels",id:61,options:{default:0}},{rule:"optional",type:"int32",name:"new_height",id:62,options:{default:0}},{rule:"optional",type:"int32",name:"new_width",id:63,options:{default:0}},{rule:"optional",type:"bool",name:"shuffle_images",id:64,options:{default:!1}},{rule:"optional",type:"uint32",name:"concat_dim",id:65,options:{default:1}},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:1001}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]}]},{name:"PReLUParameter",fields:[{rule:"optional",type:"FillerParameter",name:"filler",id:1},{rule:"optional",type:"bool",name:"channel_shared",id:2,options:{default:!1}}]}],enums:[{name:"Phase",values:[{name:"TRAIN",id:0},{name:"TEST",id:1}]}]}).build();return this.parseProto(t,e.caffe)},e}(t.BinaryParser);t.BinaryprotoParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parseProto=function(t,e){for(var a=e.BlobProto.decode(t),i=a.width,o=a.height,n=a.channels,r=a.data,s=new Net.Vol(i,o,n,0),p=0;p<n;p++)for(var l=0;l<o;l++)for(var u=0;u<i;u++){var d=(o*p+l)*i+u;s.set(u,l,p,r[d])}return s},e}(t.BinaryprotoParser);t.BlobProtoParser=e}(Parser||(Parser={}));var Parser;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parseString=function(t){return prototxtParser.parse(t)},e}(t.TextParser);t.PrototxtParser=e}(Parser||(Parser={}));var Net;!function(t){var e=function(e){function a(t,a){var i=e.call(this)||this;return i.modelPath=t,i.weightPath=a,i}return __extends(a,e),a.prototype.load=function(){var t=this;return this.fetch(this.modelPath).then(function(e){return t.create(e)}).then(function(e){return t.loadWeights()})},a.prototype.fromText=function(t){var e=new Parser.PrototxtParser;return this.create(e.parseString(t)),this},a.prototype.fetch=function(t){return(new Parser.PrototxtParser).parse(t)},a.prototype.create=function(t){this.name=t.name,this.createLayers(t,t.layer||t.layers,"data"===t.input),this.createEdges()},a.prototype.caffeLayerToJs=function(e){var a,i=this,o={name:e.name,input:e.bottom,output:e.top};switch(void 0!==e.bottom&&(Array.isArray(e.bottom)?o.pred=e.bottom.map(function(t){return i.layers.get(t)}):o.pred=[this.layers.get(e.bottom)]),e.type.toLowerCase()){case"input":n=e.input_param||{};o.out_depth=+n.shape.dim[1],o.out_sx=+n.shape.dim[2],o.out_sy=+n.shape.dim[3],a=new t.Layers.InputLayer(o);break;case"conv":case"convolution":var n=e.param||{},r=e.convolution_param||{};o.sx=void 0!==r.kernel_size?+r.kernel_size:void 0,o.filters=void 0!==r.num_output?+r.num_output:void 0,o.pad=void 0!==r.pad?+r.pad:void 0,o.stride=void 0!==r.stride?+r.stride:void 0,o.l1_decay_mul=n&&n.length&&void 0!==n[0].decay_mult?+n[0].decay_mult:0,o.l2_decay_mul=n&&n.length&&void 0!==n[1].decay_mult?+n[1].decay_mult:1,o.group=void 0!==r.group?+r.group:1,a=new t.Layers.ConvLayer(o);break;case"lrn":n=e.lrn_param||{};o.k=void 0!==n.k?+n.k:1,o.n=void 0!==n.local_size?+n.local_size:void 0,o.alpha=void 0!==n.alpha?+n.alpha:void 0,o.beta=void 0!==n.beta?+n.beta:void 0,a=new t.Layers.LocalResponseNormalizationLayer(o);break;case"dropout":var s=e.dropout_param||{};o.drop_prob=void 0!==s.dropout_ratio?+s.dropout_ratio:void 0,a=new t.Layers.DropoutLayer(o);break;case"concat":r=e.concat_param||{};o.axis=void 0!==r.axis?+r.axis:void 0,a=new t.Layers.ConcatLayer(o);break;case"pool":case"pooling":p=e.pooling_param||{};o.pool=void 0!==p.pool?p.pool:void 0,o.sx=void 0!==p.kernel_size?+p.kernel_size:void 0,o.pad=void 0!==p.pad?+p.pad:void 0,o.stride=void 0!==p.stride?+p.stride:void 0,o.global_pooling=void 0!==p.global_pooling&&"false"!==p.global_pooling,a=new t.Layers.PoolLayer(o);break;case"inner_product":case"innerproduct":var p=e.inner_product_param||{},n=e.param||{};o.num_neurons=void 0!==p.num_output?+p.num_output:void 0,o.l1_decay_mul=n&&n.length&&void 0!==n[0].decay_mult?+n[0].decay_mult:0,o.l2_decay_mul=n&&n.length&&void 0!==n[1].decay_mult?+n[1].decay_mult:1,a=new t.Layers.FullyConnectedLayer(o);break;case"softmax":a=new t.Layers.SoftmaxLayer(o);break;case"relu":a=new t.Layers.ReluLayer(o);break;case"sigmoid":a=new t.Layers.SigmoidLayer(o);break;case"tanh":a=new t.Layers.TanhLayer(o);break;default:return void console.error("Cannot parse layer "+e.type,e)}this.layers.set(a.name,a)},a.prototype.createLayers=function(e,a,i){var o=this;void 0===i&&(i=!1),this.layers=d3.map(),i&&this.layers.set("data",new t.Layers.InputLayer({name:"data",in_depth:+e.input_dim[1],in_sy:+e.input_dim[2],in_sx:+e.input_dim[3]})),a.forEach(function(t){return o.caffeLayerToJs(t)})},a.prototype.createEdges=function(){var t=this;this.edges=[];var e=d3.set(),a=function(t,e){return t+":#:"+e};this.layers.values().filter(function(t){return void 0!==t.input&&t.input!==t.output}).forEach(function(i){Array.isArray(i.input)?i.input.forEach(function(o){e.has(a(o,i.output))||(t.edges.push({from:o,to:i.output}),e.add(a(o,i.output)))}):t.edges.push({from:i.input,to:i.output})}),this.layers.values().filter(function(t){return void 0!==t.input&&t.input===t.output}).forEach(function(i){t.edges.filter(function(t){return t.from===i.input}).forEach(function(o){o.from=i.name,e.has(a(i.input,i.name))||(t.edges.push({from:i.input,to:i.name}),e.add(a(i.input,i.name)))})})},a.prototype.loadWeights=function(){var t=this;return this.weightPath?Promise.all(this.layers.values().filter(function(t){return"conv"==t.layer_type||"fc"==t.layer_type}).map(function(e){return Promise.all([fetch(t.weightPath+e.name+"_filter.bin").then(function(t){return t.arrayBuffer()}).then(function(t){for(var a=new Float32Array(t),i=void 0===e.num_inputs?Math.ceil(e.sx*e.sy*e.in_depth/e.conv_groups):e.num_inputs,o=0;o<e.out_depth;o++)e.filters[o].w.set(a.slice(o*i,o*i+i))}),fetch(t.weightPath+e.name+"_bias.bin").then(function(t){return t.arrayBuffer()}).then(function(t){var a=new Float32Array(t);e.biases.w.set(a)})])})):Promise.resolve()},a}(t.Model);t.CaffeModel=e}(Net||(Net={}));var ImgJS;!function(t){var e=NumJS,a=function(){function t(t){this.src=t,this.canvas=document.createElement("canvas"),this.image=document.createElement("img")}return t.prototype.set=function(t){return this.data=t.data,this.image.width=t.width,this.image.height=t.height,this},t.prototype.load=function(){var t=this;return new Promise(function(e,a){var i=t.canvas.getContext("2d");t.image.onload=function(){i.imageSmoothingEnabled=!1,t.canvas.width=t.image.width,t.canvas.height=t.image.height,i.drawImage(t.image,0,0);var a=i.getImageData(0,0,t.image.width,t.image.height);t.data=a.data,e(t.data)},t.image.src=t.src+"?"+(new Date).getTime(),t.image.setAttribute("crossOrigin","")})},t.prototype.render=function(t){void 0===t&&(t=this.canvas,document.body.appendChild(t)),t.width=this.image.width,t.height=this.image.height;var e=t.getContext("2d");e.imageSmoothingEnabled=!1;var a=e.getImageData(0,0,this.image.width,this.image.height);a.data.set(this.data),e.putImageData(a,0,0)},t.fromMean=function(e,a,i,o){return void 0===a&&(a=0),void 0===i&&(i=1),void 0===o&&(o=!1),t.fromVol(e,0,[0,1,2],i,o)},t.fromFilter=function(e,a,i,o){return void 0===a&&(a=0),void 0===i&&(i=1),void 0===o&&(o=!0),t.fromVol(e,0,a,i,o)},t.fromVol=function(a,i,o,n,r,s){void 0===o&&(o=[2,1,0]),void 0===n&&(n=1),void 0===r&&(r=!1),void 0===s&&(s=255);var p=new t;i=void 0!==i?i:[0,0,0];for(var l=a.sx,u=a.sy,d=l*u*4,m=e.maxmin(a.w),h=o?o instanceof Array?o[0]:+o:0,f=o?o instanceof Array?o[1]:+o:0,y=o?o instanceof Array?o[2]:+o:0,_=new Uint8ClampedArray(d),c=0;c<u;c++)for(var v=0;v<l;v++){var g=4*(c*l+v),w=i?i instanceof Net.Vol?i.get(v,c,h):+i[h]:0,P=i?i instanceof Net.Vol?i.get(v,c,f):+i[f]:0,N=i?i instanceof Net.Vol?i.get(v,c,y):+i[y]:0,x=a.get(v,c,h),S=a.get(v,c,f),b=a.get(v,c,y);r&&(x=Math.floor((a.get(v,c,h)-m.minv)/m.dv*255),S=Math.floor((a.get(v,c,f)-m.minv)/m.dv*255),b=Math.floor((a.get(v,c,y)-m.minv)/m.dv*255)),_[g+0]=x+w,_[g+1]=S+P,_[g+2]=b+N,_[g+3]=s}return p.image.width=l,p.image.height=u,p.data=_,p},t.prototype.toVol=function(t,e){void 0===e&&(e=[2,1,0]),t=void 0!==t?t:[0,0,0];for(var a=this.image.width,i=this.image.height,o=e[0],n=e[1],r=e[2],s=new Net.Vol(a,i,3,0),p=0;p<i;p++)for(var l=0;l<a;l++){var u=4*(p*a+l),d=t instanceof Net.Vol?t.get(l,p,o):+t[o],m=t instanceof Net.Vol?t.get(l,p,n):+t[n],h=t instanceof Net.Vol?t.get(l,p,r):+t[r];s.set(l,p,o,this.data[u+0]-d),s.set(l,p,n,this.data[u+1]-m),s.set(l,p,r,this.data[u+2]-h)}return s},t}();t.Image=a}(ImgJS||(ImgJS={}));var Utils;!function(t){var e=ImgJS,a=function(t){function a(){return t.call(this)||this}return __extends(a,t),a.prototype.render=function(t,a,i,o,n){void 0===a&&(a=!0);var r=d3.select(t);r.selectAll("*").remove(),this.layerIterator(function(t,o){if(a||0!=o){r.append("h5").text(t.name);for(var n=r.append("div").attr("class","net-layer").append("div").attr("class","net-vis"),s=(n.append("div").attr("class","net-weights"),n.append("div").attr("class","net-activations")),p=0,l=t.out_act.depth;p<l;++p){if(i&&p>=i)return;var u=s.append("canvas"),d=t.out_act;e.Image.fromFilter(d,p,1).render(u[0][0])}}})},a.fromNet=function(t){var e=new a;return e.layers=t.layers,e.edges=t.edges,e},a}(Net.Model);t.ActivationDrawer=a}(Utils||(Utils={}));var Utils;!function(t){var e=function(t){function e(e){void 0===e&&(e=!1);var a=t.call(this)||this;return a.compact=e,a}return __extends(e,t),e.prototype.destructor=function(){window&&window.addEventListener("resize",null)},e.prototype.render=function(t,e,a){this.width=e,this.height=a;var i=new dagreD3.render;return this.graph=this.compact?this.createCompactGraph():this.createGraph(),this.$elem=d3.select(t),this.$elem.selectAll("*").remove(),this.$svg=this.$elem.append("svg"),this.$g=this.$svg.append("g"),i(this.$g,this.graph),this.postProcessGraph(),this},e.prototype.autoScale=function(){var t=this;return window&&window.addEventListener("resize",function(){return t.postProcessGraph()}),this},e.prototype.fit=function(){return this.$svg.attr("viewBox","0 0 "+this.graph.graph().width+" "+this.graph.graph().height),this},e.prototype.rotate=function(){var t=(this.width-this.graph.graph().width)/2;return this.$g.attr("transform","rotate(270) translate("+t+")"),this.$svg.attr("viewBox","0 0 "+this.graph.graph().height+" "+this.graph.graph().width),this},e.prototype.getHeightScaleTemplate=function(t){return void 0===t&&(t=.25),d3.scale.pow().exponent(t).range([e.MIN_LAYER_HEIGHT,e.MAX_LAYER_HEIGHT]).clamp(!0)},e.prototype.getWidthScaleTemplate=function(t){return void 0===t&&(t=.75),d3.scale.pow().exponent(t).range([e.MIN_LAYER_WIDTH,e.MAX_LAYER_WIDTH]).clamp(!0)},e.prototype.getWidthScale=function(){var t=d3.extent(this.layers.values(),function(t){return t.getOutputShape()[1]}),e=d3.extent(this.layers.values(),function(t){return t.getOutputShape()[2]}),a=this.getWidthScaleTemplate().domain([Math.min(t[0],e[0]),Math.max(t[1],e[1])]);return function(t){var e=Math.max(t.getOutputShape()[1],t.getOutputShape()[2]);return a(e)}},e.prototype.getHeightScale=function(){var t=d3.extent(this.layers.values(),function(t){return t.getOutputShape()[0]}),e=this.getHeightScaleTemplate().domain([t[0],t[1]]);return function(t){var a=t.getOutputShape()[0];return e(a)}},e.prototype.createCompactGraph=function(){var t=(new dagreD3.graphlib.Graph).setGraph({}).setDefaultEdgeLabel(function(){return""}),a=this.getWidthScale(),i=this.getHeightScale(),o=function(t,e){return""!=t?t+e:t},n=function(t,e){return""!=t?e+t:t},r=function(t){return"<strong>"+t+"</strong>"},s=d3.format("s"),p=function(t){var e=d3.sum(t.values,function(t){return d3.sum(t.getNumParameters())});return e?o(s(e)," parameters"):""},l=function(t){return 1===t.values.length?t.values.map(function(t){return r(t.getDescription()[0])})[0]:t.values.length<=5?t.values.map(function(t){return r(t.getDescription()[0])}).join(" + "):r(t.key.split(e.LAYER_NAME_SEP)[0].toUpperCase())},u=function(t){return 1===t.values.length?t.values[0].layer_type:t.values.length<=5?t.values[0].layer_type:t.key.split(e.LAYER_NAME_SEP)[0].replace(/\d/g,"")},d=d3.nest().key(function(t){return t.name.split(e.LAYER_GROUP_SEP)[0]}).entries(this.layers.values());return d.forEach(function(e,o){var r=e.values[e.values.length-1];if(t.setNode(e.key,{labelType:"html",label:l(e)+n(p(e),"<br>"),class:"layer layer-"+u(e),width:a(r),height:i(r)}),o>0){var s=d[o-1],m=s.values[s.values.length-1];t.setEdge(s.key,e.key,{label:m.getOutputShape().join("x"),class:"edge"})}}),e.addRoundCorners(t)},e.prototype.createGraph=function(){var t=this,a=function(t,e){return t.map(function(t,a){return a===e?"<strong>"+t+"</strong>":t})},i=this.getWidthScale(),o=(new dagreD3.graphlib.Graph).setGraph({}).setDefaultEdgeLabel(function(){return""});return this.layerIterator(function(t,e,n){o.setNode(t.name,{labelType:"html",label:a(t.getDescription(),0).join("<br>"),class:"layer layer-"+t.layer_type,width:i(t)})}),this.edges.filter(function(t){return void 0!==t.from&&void 0!==t.to}).forEach(function(e){o.setEdge(e.from,e.to,{label:t.layers.get(e.from).getOutputShape().join("x"),class:"edge"})}),e.addRoundCorners(o)},e.addRoundCorners=function(t){return t.nodes().forEach(function(a){var i=t.node(a);i.rx=i.ry=e.NODE_RADIUS}),t},e.fromNet=function(t,a){void 0===a&&(a=!1);var i=new e(a);return i.layers=t.layers,i.edges=t.edges,i},e.prototype.postProcessGraph=function(){var t=this.$elem[0][0].getBoundingClientRect();this.$svg.attr("width",this.width||this.graph.graph().width),this.$svg.attr("height",this.height||this.graph.graph().height);var e=(t.width-this.graph.graph().width)/2;e&&this.$g.attr("transform","translate("+e+")"),this.$svg.selectAll(".layer foreignObject > div").style({margin:"0 -1000%",display:"block"})},e.MIN_LAYER_HEIGHT=16,e.MAX_LAYER_HEIGHT=48,e.MIN_LAYER_WIDTH=128,e.MAX_LAYER_WIDTH=512,e.NODE_RADIUS=4,e.LAYER_GROUP_SEP="/",e.LAYER_NAME_SEP="_",e}(Net.Model);t.GraphDrawer=e}(Utils||(Utils={}));
//# sourceMappingURL=caffe.min.js.map
